<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation Plugin TextEditor - TableFlow</title>
    <link rel="stylesheet" href="documentation.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Styles additionnels sp√©cifiques si n√©cessaire */
        body { padding: 2rem; }
        .content { margin-left: 0; } /* Pas de nav lat√©rale dans ce doc standalone */
         h1 { margin-bottom: 2rem; }
         tr.modified td { background-color: #fffbeb; } /* Style pour la coh√©rence */
         /* Styles du menu contextuel (si utilis√©) */
         .tf-context-menu{position:absolute;z-index:1000;display:none;background:#fff;border:1px solid #ccc;border-radius:4px;box-shadow:0 2px 10px rgba(0,0,0,.2);padding:5px 0;min-width:180px}
         .tf-menu-item{padding:8px 15px;cursor:pointer;display:flex;align-items:center}
         .tf-menu-item:hover{background:#f5f5f5}
         .tf-menu-separator{height:1px;background:#ddd;margin:5px 0}
         .tf-menu-header{padding:5px 10px;font-weight:700;color:#666;font-size:.9em}
         .menu-icon{margin-right:8px;font-size:1.1em;width:20px;text-align:center}
    </style>
</head>
<body>
    <div class="container">
        <div class="content">
            <h1>Documentation Plugin TextEditor</h1>

            <section id="plugin-texteditor-intro">
                <h2>Objectif</h2>
                <p>
                    Le plugin <strong>TextEditor</strong> est une extension con√ßue pour enrichir l'exp√©rience d'√©dition de texte offerte par le plugin <a href="#plugin-edit">Edit</a>. Il ajoute des actions sp√©cifiques pour manipuler le contenu textuel des cellules √©ditables.
                </p>
                <p>
                    Ces actions peuvent inclure, par exemple, la suppression de phrases, la mise en majuscules, ou la suppression de motifs bas√©s sur des expressions r√©guli√®res. Les actions peuvent √™tre d√©clench√©es via des raccourcis clavier configurables ou via le menu contextuel (si le plugin <a href="#plugin-contextmenu">ContextMenu</a> est √©galement activ√©).
                </p>
                <div class="warning-block">
                    <strong>D√©pendances :</strong> Ce plugin <strong>n√©cessite</strong> que le plugin <strong>Edit</strong> soit activ√©. Son int√©gration au menu contextuel n√©cessite le plugin <strong>ContextMenu</strong>.
                </div>
            </section>

            <section id="plugin-texteditor-activation">
                <h2>Activation et Configuration HTML</h2>
                <p>
                    Ce plugin ne n√©cessite <strong>aucun attribut HTML sp√©cifique</strong> sur les √©l√©ments <code>&lt;th&gt;</code> ou <code>&lt;td&gt;</code> pour son activation. Il s'applique automatiquement aux cellules rendues √©ditables par le plugin Edit.
                </p>
                <p>
                    Son activation se fait uniquement via la configuration JavaScript.
                </p>
                <pre><code class="language-html">&lt;!-- Exemple de table o√π TextEditor pourrait s'appliquer --&gt;
&lt;table id="maTable"&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th id="colTitre" th-edit&gt;Titre&lt;/th&gt;
      &lt;th id="colDescription" th-edit&gt;Description (Long texte)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;!-- Lignes de donn√©es --&gt;
  &lt;/tbody&gt;
&lt;/table&gt;</code></pre>
            </section>

            <section id="plugin-texteditor-config-js">
                <h2>Configuration JavaScript</h2>
                <p>
                    La configuration du plugin se fait dans l'objet d'options de `TableFlow`, sous la cl√© <code class="value">plugins.texteditor</code>.
                </p>
                <pre><code class="language-javascript">const tableInstance = new TableFlow({
    tableId: 'maTable',
    pluginsPath: '../plugins', // Ajustez
    plugins: {
        // IMPORTANT: 'Edit' doit √™tre activ√©. 'ContextMenu' est optionnel mais recommand√©.
        names: ['Edit', 'ContextMenu', 'TextEditor', /* ... autres plugins ... */],
        texteditor: { // Configuration sp√©cifique pour 'TextEditor'
            // --- Options G√©n√©rales ---
            debug: false, // Activer les logs sp√©cifiques

            // --- Actions de Texte ---
            actions: {
                // Actions int√©gr√©es (peuvent √™tre d√©sactiv√©es ou surcharg√©es)
                deleteSentence: { // ID de l'action
                    label: 'Supprimer cette phrase', // Texte affich√© dans le menu
                    icon: '‚úÇÔ∏è', // Ic√¥ne pour le menu
                    handler: /* fonction interne */
                },
                deleteRegexMatch: {
                    label: 'Supprimer texte contenant...',
                    icon: 'üîç',
                    handler: /* fonction interne (demande une regex via prompt) */
                },
                capitalizeSentence: {
                    label: 'Mettre en majuscules',
                    icon: 'Aa',
                    handler: /* fonction interne (met la 1√®re phrase en majuscules) */
                },

                // Ajouter des actions personnalis√©es
                'toLowerCase': {
                    label: 'Mettre en minuscules',
                    icon: 'aa',
                    handler: function(cell, text) { // this est l'instance du plugin
                        if (text) this.updateCellValue(cell, text.toLowerCase());
                    }
                }
            },

            // --- Raccourcis Clavier ---
            shortcutsEnabled: true, // Activer les raccourcis (d√©faut: true)
            shortcuts: {
                // Format: 'Modifier+Key': 'actionId'
                'Ctrl+Delete': 'deleteSentence', // Raccourci par d√©faut
                'Ctrl+Shift+L': 'toLowerCase' // Raccourci pour notre action perso
                // ... autres raccourcis
            },

            // --- Int√©gration Menu Contextuel ---
            // Nom de la section dans le menu (si ContextMenuPlugin est actif)
            menuSection: '√âdition Texte' // D√©faut: 'Texte'
        },
        edit: { /* ... config Edit ... */ },
        contextmenu: { /* ... config ContextMenu ... */ }
    }
    // ... autres options TableFlow ...
});</code></pre>

                <h3>Tableau Complet des Options de Configuration JS (`plugins.texteditor`)</h3>
                <div class="info-block">
                    Ce tableau liste toutes les options configurables pour le plugin TextEditor via l'objet `plugins.texteditor`.
                </div>
                <table class="documentation-table">
                    <thead>
                        <tr><th>Option (dans `plugins.texteditor`)</th><th>Type</th><th>D√©faut</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code class="attr">debug</code></td><td class="type">boolean</td><td><code class="default">false</code></td><td>Active les logs de d√©bogage sp√©cifiques au plugin TextEditor. H√©rite de l'option `debug` globale de TableFlow si non sp√©cifi√©e ici.</td></tr>
                        <tr><td><code class="attr">actions</code></td><td class="type">object</td><td><code class="default">{...}</code> (voir code)</td><td>Objet d√©finissant les actions de manipulation de texte disponibles. La cl√© est un ID unique pour l'action, la valeur est un objet avec `label`, `icon`, et `handler` (voir tableau suivant). Vous pouvez surcharger ou supprimer les actions par d√©faut, ou en ajouter de nouvelles.</td></tr>
                        <tr><td><code class="attr">shortcutsEnabled</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Si `true`, le plugin √©coutera les √©v√©nements clavier (via le hook `onKeydown` du plugin Edit) pour d√©clencher les actions d√©finies dans `shortcuts`.</td></tr>
                        <tr><td><code class="attr">shortcuts</code></td><td class="type">object</td><td><code class="default">{'Ctrl+Delete': 'deleteSentence'}</code></td><td>Objet associant une combinaison de touches (ex: `'Ctrl+S'`, `'Alt+Shift+P'`) √† l'ID d'une action d√©finie dans `actions`.</td></tr>
                        <tr><td><code class="attr">menuSection</code></td><td class="type">string</td><td><code class="default">'Texte'</code></td><td>Nom de la section sous laquelle les actions de ce plugin appara√Ætront dans le menu contextuel (si le plugin ContextMenu est actif). Mettre √† `null` ou `false` pour ne pas avoir d'en-t√™te de section.</td></tr>
                    </tbody>
                </table>

                <h3>Structure de D√©finition d'une Action (dans `plugins.texteditor.actions`)</h3>
                 <div class="info-block">
                    Ce tableau d√©taille les propri√©t√©s n√©cessaires pour d√©finir une action de texte personnalis√©e.
                 </div>
                <table class="documentation-table">
                     <thead>
                         <tr><th>Propri√©t√© (dans `actions[actionId]`)</th><th>Type</th><th>Requis?</th><th>Description</th></tr>
                     </thead>
                     <tbody>
                         <tr><td><code class="attr">label</code></td><td class="type">string</td><td>Oui</td><td>Le texte qui sera affich√© dans le menu contextuel pour cette action.</td></tr>
                         <tr><td><code class="attr">icon</code></td><td class="type">string</td><td>Non</td><td>HTML (ou caract√®re) de l'ic√¥ne √† afficher √† c√¥t√© du label dans le menu contextuel.</td></tr>
                         <tr><td><code class="attr">handler</code></td><td class="type">function</td><td>Oui</td><td>La fonction JavaScript √† ex√©cuter lorsque l'action est d√©clench√©e (via menu ou raccourci). Re√ßoit deux arguments : `(cell, currentValue)`, o√π `cell` est l'√©l√©ment `<td>` cibl√© et `currentValue` est sa valeur textuelle actuelle. La fonction `this` √† l'int√©rieur du handler r√©f√©rence l'instance du plugin TextEditor, vous permettant d'appeler `this.updateCellValue(cell, newValue)`.</td></tr>
                     </tbody>
                 </table>
            </section>

            <section id="plugin-texteditor-how-it-works">
                <h2>Fonctionnement Interne</h2>
                <ul>
                    <li><strong>Initialisation (`init`):</strong>
                        <ul>
                            <li>R√©cup√®re les instances des plugins `Edit` (requis) et `ContextMenu` (optionnel).</li>
                            <li>Si `ContextMenu` est trouv√©, s'enregistre comme fournisseur de menu (`contextMenuPlugin.registerProvider(this)`).</li>
                            <li>Si les raccourcis sont activ√©s (`shortcutsEnabled`), s'enregistre au hook `onKeydown` du plugin `Edit` (`registerWithEditPlugin`).</li>
                        </ul>
                    </li>
                    <li><strong>Int√©gration Menu Contextuel (`getMenuItems`):</strong>
                        <ul>
                            <li>M√©thode appel√©e par le plugin `ContextMenu` lorsqu'un clic droit est d√©tect√© sur une cellule.</li>
                            <li>V√©rifie si la cellule est √©ditable (a la classe du plugin Edit).</li>
                            <li>Si oui, retourne un tableau d'objets d√©crivant les actions d√©finies dans `config.actions`, pr√©c√©d√©es √©ventuellement d'un en-t√™te de section (`menuSection`).</li>
                        </ul>
                    </li>
                    <li><strong>Ex√©cution d'Action (`executeAction`):</strong>
                        <ul>
                            <li>M√©thode appel√©e par le plugin `ContextMenu` lorsqu'un utilisateur clique sur une action de ce plugin dans le menu.</li>
                            <li>Trouve le `handler` correspondant √† l'`actionId` dans `config.actions`.</li>
                            <li>R√©cup√®re la valeur actuelle de la `cell`.</li>
                            <li>Appelle le `handler(cell, currentValue)`.</li>
                        </ul>
                    </li>
                     <li><strong>Gestion des Raccourcis (`handleKeydown`):</strong>
                        <ul>
                            <li>M√©thode appel√©e par le hook `onKeydown` du plugin `Edit`.</li>
                            <li>Construit une cha√Æne repr√©sentant la combinaison de touches appuy√©e (ex: 'Ctrl+Delete').</li>
                            <li>Cherche si cette combinaison existe dans `config.shortcuts`.</li>
                            <li>Si oui, trouve l'`actionId` correspondant et appelle `executeAction(actionId, cell)`.</li>
                            <li>Emp√™che le traitement ult√©rieur de l'√©v√©nement (`event.preventDefault()`) et retourne `false` pour indiquer au plugin Edit de ne pas traiter cette touche.</li>
                            <li>Si aucune combinaison ne correspond, retourne `true` pour laisser Edit g√©rer l'√©v√©nement.</li>
                        </ul>
                    </li>
                    <li><strong>Actions Int√©gr√©es (`deleteSentence`, `deleteRegexMatch`, `capitalizeSentence`):</strong>
                        <ul>
                            <li>Impl√©mentent la logique sp√©cifique √† chaque action.</li>
                            <li>Utilisent des m√©thodes utilitaires comme `splitIntoSentences`.</li>
                            <li>Appellent `updateCellValue` pour appliquer les modifications.</li>
                            <li>`deleteRegexMatch` utilise `prompt()` pour demander le motif √† l'utilisateur.</li>
                            <li>Les actions sur les phrases agissent sur la premi√®re phrase par simplicit√© (pas de d√©tection de curseur).</li>
                        </ul>
                    </li>
                    <li><strong>Mise √† Jour Cellule (`updateCellValue`):</strong>
                        <ul>
                            <li>Met √† jour l'attribut `data-value`.</li>
                            <li>Met √† jour le contenu visible (via le wrapper).</li>
                            <li>Ajoute la classe `modifiedClass` √† la ligne parente.</li>
                            <li>D√©clenche l'√©v√©nement `cell:change` avec `source: 'textEditor'`.</li>
                        </ul>
                    </li>
                </ul>
                 <div class="info-block">
                    <strong>Note sur les Hooks :</strong> Comme pour le plugin `Validation`, ce plugin repose sur l'existence de hooks (`addHook`, `onKeydown`) dans le plugin `Edit`. Assurez-vous que votre version du plugin `Edit` supporte ce m√©canisme d'extension.
                </div>
                 <div class="warning-block">
                    <strong>Limites des Actions sur Phrases :</strong> Les actions `deleteSentence` et `capitalizeSentence` fournies agissent sur la *premi√®re* phrase du texte par d√©faut, car il n'y a pas de moyen simple de d√©terminer la position du curseur ou du clic dans le texte via le menu contextuel ou un raccourci clavier standard. Une impl√©mentation plus avanc√©e n√©cessiterait une int√©gration plus profonde avec l'√©tat d'√©dition.
                </div>
            </section>

             <section id="plugin-texteditor-api">
                <h2>API Publique</h2>
                <p>
                    Ce plugin ne propose pas d'API publique sp√©cifique destin√©e √† √™tre appel√©e depuis l'ext√©rieur, en dehors des m√©thodes utilis√©es pour l'int√©gration avec ContextMenu (`getMenuItems`, `executeAction`). Ses fonctionnalit√©s sont principalement d√©clench√©es par les interactions utilisateur (menu, raccourcis).
                </p>
            </section>

            <section id="plugin-texteditor-events">
                <h2>√âv√©nements</h2>
                <ul>
                    <li><strong>√âcout√©s :</strong> Aucun √©v√©nement DOM direct. S'appuie sur les hooks de `Edit` (`onKeydown`) et l'interface de `ContextMenu`.</li>
                    <li><strong>D√©clench√©s :</strong>
                        <ul>
                             <li><code>cell:change</code> : D√©clench√© via `updateCellValue` apr√®s qu'une action de texte a modifi√© la valeur d'une cellule. Contient `{ detail: { ..., source: 'textEditor', ... } }`.</li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section id="plugin-texteditor-example">
                <h2>Exemple Complet</h2>
                <p>Cet exemple montre une table avec une colonne de description √©ditable, o√π l'on peut utiliser le menu contextuel ou des raccourcis pour manipuler le texte.</p>

                <strong>HTML (`index.html`):</strong>
                <pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Exemple TextEditor Plugin&lt;/title&gt;
    <link rel="stylesheet" href="../src/tableFlow.css"> <link rel="stylesheet" href="documentation.css"> <style>
        tr.modified td { background-color: #fffbeb; }
        /* Styles menu contextuel */
        .tf-context-menu{position:absolute;z-index:1000;display:none;background:#fff;border:1px solid #ccc;border-radius:4px;box-shadow:0 2px 10px rgba(0,0,0,.2);padding:5px 0;min-width:180px}
        .tf-menu-item{padding:8px 15px;cursor:pointer;display:flex;align-items:center}
        .tf-menu-item:hover{background:#f5f5f5}
        .tf-menu-separator{height:1px;background:#ddd;margin:5px 0}
        .tf-menu-header{padding:5px 10px;font-weight:700;color:#666;font-size:.9em}
        .menu-icon{margin-right:8px;font-size:1.1em;width:20px;text-align:center}
        /* Cellule √©ditable */
        td.td-edit { cursor: pointer; }
    </style>
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;TableFlow - Exemple Plugin TextEditor&lt;/h1&gt;
    &lt;p&gt;Double-cliquez sur la description pour √©diter. Faites un clic droit pour le menu contextuel. Essayez Ctrl+Delete.&lt;/p&gt;

    &lt;table id="notesTable"&gt;
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th id="noteTitle"&gt;Titre&lt;/th&gt;
                &lt;th id="noteContent" th-edit&gt;Contenu de la Note&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
            &lt;tr id="n1"&gt;
                &lt;td id="noteTitle_n1"&gt;R√©union&lt;/td&gt;
                &lt;td id="noteContent_n1"&gt;Pr√©parer la pr√©sentation. Revoir les chiffres. Confirmer la salle.&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr id="n2"&gt;
                &lt;td id="noteTitle_n2"&gt;Id√©es&lt;/td&gt;
                &lt;td id="noteContent_n2"&gt;Nouveau concept pour le projet Alpha. Explorer l'API externe X. V√©rifier la faisabilit√© technique.&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/tbody&gt;
    &lt;/table&gt;

    &lt;script type="module"&gt;
        import TableFlow from '../src/tableFlow.js'; // Ajustez

        const notesTable = new TableFlow({
            tableId: 'notesTable',
            pluginsPath: '../plugins', // Ajustez
            debug: true,
            plugins: {
                // Activer Edit, ContextMenu et TextEditor
                names: ['Edit', 'ContextMenu', 'TextEditor'],
                texteditor: {
                    // Utiliser les actions et raccourcis par d√©faut
                    // Ajouter une action personnalis√©e
                    actions: {
                        // Garder les actions par d√©faut
                        deleteSentence: { label: 'Supprimer 1√®re phrase', icon: '‚úÇÔ∏è', handler: function(cell, text){ if(text){ const s = this.splitIntoSentences(text); s.shift(); this.updateCellValue(cell, s.join(' ')); } } },
                        deleteRegexMatch: { label: 'Supprimer motif...', icon: 'üîç', handler: function(cell, text){ if(!text) return; const p = prompt('Motif?'); if(p){ try{ this.updateCellValue(cell, text.replace(new RegExp(p,'gi'),'')); } catch(e){ alert('Regex invalide');}} } },
                        capitalizeSentence: { label: 'Majuscules 1√®re phrase', icon: 'Aa', handler: function(cell, text){ if(text){ const s = this.splitIntoSentences(text); if(s.length > 0) s[0] = s[0].toUpperCase(); this.updateCellValue(cell, s.join(' ')); } } },
                        // Nouvelle action
                        'addTimestamp': {
                            label: 'Ajouter horodatage',
                            icon: 'üïí',
                            handler: function(cell, text) {
                                const timestamp = new Date().toLocaleString('fr-FR');
                                const newText = text ? `${text}\n[Modifi√© le ${timestamp}]` : `[Cr√©√© le ${timestamp}]`;
                                this.updateCellValue(cell, newText);
                            }
                        }
                    },
                    shortcuts: {
                         'Ctrl+Delete': 'deleteSentence',
                         'Ctrl+T': 'addTimestamp' // Ajouter un raccourci
                    },
                    menuSection: 'Outils Texte' // Personnaliser le titre de section
                },
                edit: { /* Config par d√©faut */ },
                contextmenu: { /* Config par d√©faut */ }
            }
        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

                <strong>Fonctionnement de l'exemple :</strong>
                <ol>
                    <li>La colonne "Contenu de la Note" est √©ditable (double-clic).</li>
                    <li>Faites un clic droit sur une cellule de cette colonne : un menu contextuel appara√Æt avec la section "Outils Texte".</li>
                    <li>Le menu contient les options : "Supprimer 1√®re phrase", "Supprimer motif...", "Majuscules 1√®re phrase", et "Ajouter horodatage".</li>
                    <li>Choisir une option ex√©cute l'action correspondante sur le contenu de la cellule.</li>
                    <li>Pendant l'√©dition (double-clic), vous pouvez utiliser les raccourcis :
                        <ul>
                            <li>`Ctrl+Delete` : Supprime la premi√®re phrase.</li>
                            <li>`Ctrl+T` : Ajoute un horodatage √† la fin du texte.</li>
                        </ul>
                    </li>
                    <li>Toute modification via les actions ou les raccourcis marque la ligne comme modifi√©e.</li>
                </ol>
            </section>

        </div>
    </div>
</body>
</html>