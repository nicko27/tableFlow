<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation Plugin Highlight - TableFlow</title>
    <link rel="stylesheet" href="documentation.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Styles additionnels sp√©cifiques si n√©cessaire */
        body { padding: 2rem; }
        .content { margin-left: 0; } /* Pas de nav lat√©rale dans ce doc standalone */
         h1 { margin-bottom: 2rem; }
         tr.modified td { background-color: #fffbeb; } /* Style pour la coh√©rence */

         /* Styles par d√©faut du plugin Highlight */
         .tf-highlight-span { /* Classe pour le span de surlignage */
             /* Le style (couleur, fond) est appliqu√© inline */
             border-radius: 3px;
             padding: 0.1em 0; /* L√©ger padding vertical */
         }
         /* Styles pour l'√©dition avec surlignage */
         .tf-highlight-edit-container {
            position: relative;
            width: 100%;
            min-height: 24px; /* Assurer une hauteur minimale */
            padding: 4px 6px; /* Simuler le padding de l'input */
            box-sizing: border-box;
         }
         .tf-highlight-edit-input { /* L'input r√©el, rendu transparent */
            position: absolute; /* Chang√© en absolute pour superposer */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent !important; /* Force la transparence */
            color: transparent !important; /* Masque le texte r√©el */
            caret-color: black !important; /* Curseur visible */
            border: none !important; /* Pas de bordure visible */
            padding: 4px 6px !important; /* Doit correspondre au padding du conteneur/overlay */
            margin: 0 !important;
            font-size: inherit !important;
            font-family: inherit !important;
            line-height: inherit !important;
            box-sizing: border-box !important;
            z-index: 1; /* Au-dessus de l'overlay */
            white-space: pre-wrap; /* Important pour le positionnement */
            outline: none; /* Pas d'outline sur l'input */
         }
         .tf-highlight-edit-overlay { /* Couche de texte surlign√© */
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Ne capture pas les clics */
            white-space: pre-wrap; /* Respecte les retours √† la ligne */
            overflow: hidden;
            padding: 4px 6px; /* Doit correspondre au padding de l'input */
            box-sizing: border-box;
            font-size: inherit;
            font-family: inherit;
            line-height: inherit;
            color: #666; /* Couleur de base si pas surlign√© */
            z-index: 0; /* Derri√®re l'input */
         }

         /* Styles pour la modale de gestion (peuvent √™tre dans documentation.css) */
         .tf-highlight-modal {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 600px; max-width: 90%;
            max-height: 80vh;
            background-color: white;
            border: 1px solid #ccc; border-radius: 5px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            padding: 20px; z-index: 2000; overflow: auto;
         }
         .tf-modal-overlay { /* Ajout pour le fond */
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5); z-index: 1999;
         }
         .tf-modal-close { background: none; border: none; font-size: 20px; cursor: pointer; float: right; }
         .tf-rules-container { margin-bottom: 20px; max-height: 300px; overflow-y: auto; border: 1px solid #eee; padding: 10px; }
         .tf-highlight-button { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; color: white; }
         .tf-highlight-button.add { background: #4CAF50; }
         .tf-highlight-button.export { background: #2196F3; margin-right: 8px;}
         .tf-highlight-button.import { background: #FF9800; }
         .tf-highlight-button.cancel { background: #ccc; color: black;}
         .tf-highlight-button.submit { background: #4CAF50; }
         .tf-highlight-form label { display: block; margin-bottom: 5px; font-weight: bold; }
         .tf-highlight-form input[type=text],
         .tf-highlight-form select,
         .tf-highlight-form textarea { width: 100%; padding: 8px; box-sizing: border-box; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; }
         .tf-highlight-form textarea { height: 80px; }
         .tf-rule-item { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #eee; margin-bottom: 8px; }
         .tf-rule-item-regex { flex: 1; font-family: monospace; font-size: 0.9em; margin-right: 10px; }
         .tf-rule-item-actions button { background: none; border: 1px solid #ddd; border-radius: 3px; padding: 3px 8px; cursor: pointer; margin-left: 5px; }

    </style>
</head>
<body>
    <div class="container">
        <div class="content">
            <h1>Documentation Plugin Highlight</h1>

            <section id="plugin-highlight-intro">
                <h2>Objectif</h2>
                <p>
                    Le plugin <strong>Highlight</strong> permet de surligner automatiquement des portions de texte √† l'int√©rieur des cellules √©ditables d'un tableau TableFlow. Le surlignage est bas√© sur des **r√®gles** d√©finies par l'utilisateur, utilisant des **expressions r√©guli√®res** pour identifier les textes √† mettre en √©vidence.
                </p>
                <p>
                    Les r√®gles sont organis√©es en **groupes**, chaque groupe ayant un style de surlignage sp√©cifique (couleur de texte, couleur de fond) et une **priorit√©**. Le plugin g√®re intelligemment les chevauchements : si plusieurs r√®gles correspondent √† la m√™me portion de texte, c'est la r√®gle du groupe ayant la plus haute priorit√© (valeur num√©rique la plus basse) qui s'applique. Un groupe sp√©cial "Ignor√©" permet de d√©finir des motifs qui ne doivent jamais √™tre surlign√©s, m√™me s'ils correspondent √† une autre r√®gle.
                </p>
                <p>
                    Le plugin offre √©galement :
                </p>
                <ul>
                    <li>La persistance des groupes et des r√®gles dans le `localStorage`.</li>
                    <li>Une interface utilisateur (modale) pour g√©rer les r√®gles (ajouter, modifier, supprimer, activer/d√©sactiver).</li>
                    <li>La possibilit√© d'importer et d'exporter la configuration (groupes et r√®gles) au format JSON.</li>
                    <li>Une int√©gration avec le plugin <a href="#plugin-edit">Edit</a> pour appliquer le surlignage et (optionnellement) le maintenir pendant l'√©dition de la cellule.</li>
                    <li>Une int√©gration avec le plugin <a href="#plugin-contextmenu">ContextMenu</a> pour ajouter des actions contextuelles (activer/d√©sactiver, g√©rer les r√®gles, ajouter une r√®gle √† partir du texte s√©lectionn√©).</li>
                </ul>
                 <div class="warning-block">
                    <strong>D√©pendances :</strong> Ce plugin <strong>n√©cessite</strong> que le plugin <strong>Edit</strong> soit activ√©. Son int√©gration au menu contextuel n√©cessite le plugin <strong>ContextMenu</strong>. Il repose √©galement sur des hooks (`onRender`, `afterEdit`) du plugin Edit.
                </div>
            </section>

            <section id="plugin-highlight-activation">
                <h2>Activation et Configuration HTML</h2>
                <p>
                    Ce plugin ne n√©cessite <strong>aucun attribut HTML sp√©cifique</strong> sur les √©l√©ments <code>&lt;th&gt;</code> ou <code>&lt;td&gt;</code> pour son activation. Il s'applique automatiquement aux cellules rendues √©ditables par le plugin Edit.
                </p>
                <p>
                    Son activation et toute sa configuration (groupes, r√®gles, comportement) se font via JavaScript.
                </p>
            </section>

            <section id="plugin-highlight-config-js">
                <h2>Configuration JavaScript</h2>
                <p>
                    La configuration d√©taill√©e du plugin se fait dans l'objet d'options de `TableFlow`, sous la cl√© <code class="value">plugins.highlight</code>.
                </p>
                <pre><code class="language-javascript">const tableInstance = new TableFlow({
    tableId: 'maTable',
    pluginsPath: '../plugins', // Ajustez
    plugins: {
        // IMPORTANT: 'Edit' est requis. 'ContextMenu' est optionnel.
        names: ['Edit', 'ContextMenu', 'Highlight', /* ... autres ... */],
        highlight: { // Configuration sp√©cifique pour 'Highlight'
            // --- Options G√©n√©rales ---
            highlightEnabled: true, // Activer le surlignage (d√©faut: true)
            highlightDuringEdit: true, // Maintenir le surlignage pendant l'√©dition (d√©faut: true)
            highlightClass: 'tf-highlight', // Classe CSS ajout√©e aux cellules surlign√©es (non utilis√© activement dans v1.0.0)
            spanClass: 'tf-highlight-span', // Classe CSS ajout√©e aux <span> de surlignage (d√©faut)
            debug: false, // Activer les logs sp√©cifiques

            // --- Persistance ---
            storageKey: 'tableflow-highlight-rules', // Cl√© localStorage (d√©faut)
            // Mettre √† null ou false pour d√©sactiver la persistance

            // --- Groupes de Surlignage ---
            groups: [ // Tableau d√©finissant les groupes
                // Structure d'un groupe:
                {
                    id: 'keyword', // ID unique du groupe
                    name: 'Mot-Cl√©', // Nom affich√© dans l'UI
                    color: '#ffffff', // Couleur du texte (CSS)
                    backgroundColor: '#4f46e5', // Couleur de fond (CSS) (Indigo)
                    priority: 1 // Priorit√© (0 = plus haute)
                    // isExclusion: false (d√©faut)
                },
                {
                    id: 'mention',
                    name: 'Mention (@)',
                    color: '#1d4ed8', // Bleu fonc√©
                    backgroundColor: '#dbeafe', // Bleu tr√®s p√¢le
                    priority: 2
                },
                {
                    id: 'ignored', // Groupe sp√©cial pour les exclusions
                    name: 'Ignor√© (Exclusion)',
                    isExclusion: true, // Marque ce groupe comme exclusion
                    priority: 10 // Priorit√© basse pour √™tre surcharg√© facilement
                }
                // ... autres groupes
            ],

            // --- R√®gles de Surlignage ---
            // Sera charg√© depuis localStorage si storageKey est d√©fini et contient des donn√©es.
            // Peut √™tre pr√©-rempli ici.
            rules: [
                // Structure d'une r√®gle:
                {
                    id: 'rule1', // ID unique (optionnel, sera g√©n√©r√© si absent)
                    group: 'keyword', // ID du groupe auquel cette r√®gle appartient
                    regex: '\\b(urgent|important|critique)\\b', // Expression r√©guli√®re (cha√Æne)
                    exclusions: ['ne pas traiter'], // Optionnel: Regex (cha√Ænes) √† exclure de ce match
                    enabled: true // Optionnel: r√®gle active par d√©faut
                },
                {
                    id: 'rule2',
                    group: 'mention',
                    regex: '@[\\w-]+', // Correspond √† @utilisateur
                    enabled: true
                },
                 {
                    id: 'rule3',
                    group: 'ignored', // R√®gle d'exclusion
                    regex: 'TODO\\s*:', // Ignorer les "TODO :"
                    enabled: true
                }
                // ... autres r√®gles
            ],

            // --- Int√©gration Menu Contextuel ---
            menuEnabled: true, // Activer les options dans le menu contextuel (d√©faut: true)
            menuSection: 'Surlignage', // Titre de la section dans le menu (d√©faut)

            // --- Cr√©ation de R√®gles (via UI ou API) ---
            ruleCreation: {
                enabled: true, // Autoriser l'ajout de r√®gles via UI/API (d√©faut: true)
                useAjax: false, // Envoyer les nouvelles r√®gles √† un serveur? (d√©faut: false)
                ajaxUrl: '/api/highlight-rules', // URL du serveur si useAjax=true
                ajaxMethod: 'POST', // M√©thode HTTP
                ajaxHeaders: {}, // En-t√™tes HTTP additionnels
                ajaxCallback: null // Fonction (rule, serverResponse) => {} appel√©e apr√®s succ√®s AJAX
            },

            // --- Options de l'Interface Utilisateur (Modale de gestion) ---
            ui: {
                showGroupHeaders: true, // Afficher les en-t√™tes de groupe dans la liste des r√®gles (d√©faut: true)
                groupByColor: true, // Regrouper les r√®gles par groupe dans la liste (d√©faut: true)
                allowExport: true, // Afficher le bouton Exporter (d√©faut: true)
                allowImport: true, // Afficher le bouton Importer (d√©faut: true)
                modalClass: 'tf-highlight-modal', // Classe CSS pour la modale (d√©faut)
                buttonClass: 'tf-highlight-button', // Classe CSS pour les boutons (d√©faut)
                formClass: 'tf-highlight-form', // Classe CSS pour les formulaires (d√©faut)
                inputClass: 'tf-highlight-input' // Classe CSS pour les inputs (d√©faut)
            }
        },
        edit: { /* ... config Edit ... */ },
        contextmenu: { /* ... config ContextMenu ... */ }
    }
    // ... autres options TableFlow ...
});</code></pre>

                <h3>Tableau Complet des Options de Configuration JS (`plugins.highlight`)</h3>
                <div class="info-block">
                    Ce tableau liste toutes les options configurables pour le plugin Highlight via l'objet `plugins.highlight`.
                </div>
                <table class="documentation-table">
                    <thead>
                        <tr><th>Option (dans `plugins.highlight`)</th><th>Type</th><th>D√©faut</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code class="attr">highlightEnabled</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Active ou d√©sactive globalement le surlignage.</td></tr>
                        <tr><td><code class="attr">highlightDuringEdit</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Si `true`, tente de maintenir le surlignage visible pendant que l'utilisateur tape dans le champ d'√©dition (utilise une superposition).</td></tr>
                        <tr><td><code class="attr">highlightClass</code></td><td class="type">string</td><td><code class="default">'tf-highlight'</code></td><td>Classe CSS th√©oriquement ajout√©e aux cellules contenant du texte surlign√© (peu utilis√© dans la version actuelle).</td></tr>
                        <tr><td><code class="attr">spanClass</code></td><td class="type">string</td><td><code class="default">'tf-highlight-span'</code></td><td>Classe CSS ajout√©e √† chaque √©l√©ment `&lt;span&gt;` qui enveloppe un morceau de texte surlign√©. Le style (couleur, fond) est appliqu√© inline sur le span.</td></tr>
                        <tr><td><code class="attr">storageKey</code></td><td class="type">string | null</td><td><code class="default">'tableflow-highlight-rules'</code></td><td>Cl√© utilis√©e pour sauvegarder/charger les groupes et r√®gles dans le `localStorage`. Mettre √† `null` ou `false` pour d√©sactiver la persistance.</td></tr>
                        <tr><td><code class="attr">groups</code></td><td class="type">Array&lt;object&gt;</td><td><code class="default">[...]</code> (voir code)</td><td>Tableau d√©finissant les groupes de surlignage disponibles (voir structure ci-dessous).</td></tr>
                        <tr><td><code class="attr">rules</code></td><td class="type">Array&lt;object&gt;</td><td><code class="default">[]</code></td><td>Tableau contenant les r√®gles de surlignage initiales (voir structure ci-dessous). Sera √©cras√© par les donn√©es du `localStorage` si `storageKey` est valide.</td></tr>
                        <tr><td><code class="attr">menuEnabled</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Si `true` et si le plugin ContextMenu est actif, ajoute les options de surlignage au menu contextuel.</td></tr>
                        <tr><td><code class="attr">menuSection</code></td><td class="type">string</td><td><code class="default">'Surlignage'</code></td><td>Titre de la section dans le menu contextuel.</td></tr>
                        <tr><td><code class="attr">ruleCreation</code></td><td class="type">object</td><td><code class="default">{...}</code></td><td>Options relatives √† la cr√©ation de nouvelles r√®gles (voir structure ci-dessous).</td></tr>
                        <tr><td><code class="attr">ui</code></td><td class="type">object</td><td><code class="default">{...}</code></td><td>Options relatives √† l'interface utilisateur de la modale de gestion des r√®gles (voir structure ci-dessous).</td></tr>
                        <tr><td><code class="attr">debug</code></td><td class="type">boolean</td><td><code class="default">false</code></td><td>Active les logs de d√©bogage sp√©cifiques au plugin Highlight.</td></tr>
                    </tbody>
                </table>

                <h3>Structure d'un Objet Groupe (dans `plugins.highlight.groups`)</h3>
                 <table class="documentation-table">
                     <thead>
                         <tr><th>Propri√©t√©</th><th>Type</th><th>Requis?</th><th>Description</th></tr>
                     </thead>
                     <tbody>
                         <tr><td><code class="attr">id</code></td><td class="type">string</td><td>Oui</td><td>Identifiant unique pour le groupe (utilis√© dans les r√®gles).</td></tr>
                         <tr><td><code class="attr">name</code></td><td class="type">string</td><td>Oui</td><td>Nom lisible du groupe (affich√© dans l'UI).</td></tr>
                         <tr><td><code class="attr">color</code></td><td class="type">string</td><td>Non</td><td>Couleur CSS pour le texte surlign√© (ex: `'#FF0000'`, `'white'`). D√©faut: h√©rit√©.</td></tr>
                         <tr><td><code class="attr">backgroundColor</code></td><td class="type">string</td><td>Non</td><td>Couleur CSS pour le fond du texte surlign√© (ex: `'yellow'`, `'#a855f7'`). D√©faut: transparent.</td></tr>
                         <tr><td><code class="attr">priority</code></td><td class="type">number</td><td>Non</td><td>Priorit√© du groupe pour r√©soudre les chevauchements (0 = plus haute priorit√©). D√©faut: 0.</td></tr>
                         <tr><td><code class="attr">isExclusion</code></td><td class="type">boolean</td><td>Non</td><td>Si `true`, les r√®gles de ce groupe d√©finissent des motifs √† ne *jamais* surligner, m√™me s'ils correspondent √† une r√®gle d'un autre groupe. D√©faut: `false`.</td></tr>
                     </tbody>
                 </table>

                 <h3>Structure d'un Objet R√®gle (dans `plugins.highlight.rules`)</h3>
                 <table class="documentation-table">
                     <thead>
                         <tr><th>Propri√©t√©</th><th>Type</th><th>Requis?</th><th>Description</th></tr>
                     </thead>
                     <tbody>
                         <tr><td><code class="attr">id</code></td><td class="type">string</td><td>Non</td><td>Identifiant unique pour la r√®gle. Sera g√©n√©r√© automatiquement si absent lors de l'ajout.</td></tr>
                         <tr><td><code class="attr">group</code></td><td class="type">string</td><td>Oui</td><td>ID du groupe (d√©fini dans `config.groups`) auquel cette r√®gle appartient. D√©termine le style et la priorit√©.</td></tr>
                         <tr><td><code class="attr">regex</code></td><td class="type">string</td><td>Oui</td><td>L'expression r√©guli√®re (fournie comme cha√Æne) utilis√©e pour trouver les correspondances dans le texte.</td></tr>
                         <tr><td><code class="attr">exclusions</code></td><td class="type">Array&lt;string&gt;</td><td>Non</td><td>Tableau optionnel d'expressions r√©guli√®res (cha√Ænes). Si une correspondance trouv√©e par `regex` correspond √©galement √† l'une de ces exclusions, elle sera ignor√©e pour *cette r√®gle sp√©cifique*.</td></tr>
                         <tr><td><code class="attr">enabled</code></td><td class="type">boolean</td><td>Non</td><td>Indique si la r√®gle est active. D√©faut: `true`.</td></tr>
                     </tbody>
                 </table>

                 <h3>Structure de l'Objet `ruleCreation` (dans `plugins.highlight`)</h3>
                 <table class="documentation-table">
                     <thead>
                         <tr><th>Propri√©t√©</th><th>Type</th><th>D√©faut</th><th>Description</th></tr>
                     </thead>
                     <tbody>
                         <tr><td><code class="attr">enabled</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Autorise ou interdit l'ajout de nouvelles r√®gles via l'interface utilisateur ou l'API `addRule`.</td></tr>
                         <tr><td><code class="attr">useAjax</code></td><td class="type">boolean</td><td><code class="default">false</code></td><td>Si `true`, chaque nouvelle r√®gle ajout√©e via `addRule` sera envoy√©e au serveur √† l'`ajaxUrl` avant d'√™tre ajout√©e localement.</td></tr>
                         <tr><td><code class="attr">ajaxUrl</code></td><td class="type">string</td><td><code class="default">'/api/rules'</code></td><td>URL du endpoint serveur pour enregistrer les nouvelles r√®gles.</td></tr>
                         <tr><td><code class="attr">ajaxMethod</code></td><td class="type">string</td><td><code class="default">'POST'</code></td><td>M√©thode HTTP √† utiliser pour l'appel AJAX.</td></tr>
                         <tr><td><code class="attr">ajaxHeaders</code></td><td class="type">object</td><td><code class="default">{}</code></td><td>Objet contenant les en-t√™tes HTTP additionnels √† envoyer avec la requ√™te AJAX (ex: token d'authentification).</td></tr>
                         <tr><td><code class="attr">ajaxCallback</code></td><td class="type">function | null</td><td><code class="default">null</code></td><td>Fonction de callback `(rule, serverResponse) => {}` ex√©cut√©e apr√®s une r√©ponse r√©ussie du serveur lors de l'ajout d'une r√®gle via AJAX.</td></tr>
                     </tbody>
                 </table>

                 <h3>Structure de l'Objet `ui` (dans `plugins.highlight`)</h3>
                 <table class="documentation-table">
                     <thead>
                         <tr><th>Propri√©t√©</th><th>Type</th><th>D√©faut</th><th>Description</th></tr>
                     </thead>
                     <tbody>
                         <tr><td><code class="attr">showGroupHeaders</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Dans la modale de gestion, affiche des en-t√™tes pour chaque groupe avant de lister ses r√®gles.</td></tr>
                         <tr><td><code class="attr">groupByColor</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Dans la modale de gestion, regroupe visuellement les r√®gles par leur groupe associ√©. Si `false`, affiche une liste plate.</td></tr>
                         <tr><td><code class="attr">allowExport</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Affiche le bouton "Exporter" dans la modale de gestion.</td></tr>
                         <tr><td><code class="attr">allowImport</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Affiche le bouton "Importer" dans la modale de gestion.</td></tr>
                         <tr><td><code class="attr">modalClass</code></td><td class="type">string</td><td><code class="default">'tf-highlight-modal'</code></td><td>Classe CSS pour la fen√™tre modale de gestion des r√®gles.</td></tr>
                         <tr><td><code class="attr">buttonClass</code></td><td class="type">string</td><td><code class="default">'tf-highlight-button'</code></td><td>Classe CSS pour les boutons dans la modale.</td></tr>
                         <tr><td><code class="attr">formClass</code></td><td class="type">string</td><td><code class="default">'tf-highlight-form'</code></td><td>Classe CSS pour les formulaires dans la modale.</td></tr>
                         <tr><td><code class="attr">inputClass</code></td><td class="type">string</td><td><code class="default">'tf-highlight-input'</code></td><td>Classe CSS pour les champs de saisie dans la modale.</td></tr>
                     </tbody>
                 </table>
            </section>

            <section id="plugin-highlight-how-it-works">
                <h2>Fonctionnement Interne</h2>
                <ul>
                    <li><strong>Initialisation (`init`):</strong> R√©cup√®re les plugins Edit et ContextMenu. Charge les r√®gles depuis `localStorage` (`loadRules`). S'enregistre aupr√®s d'Edit (`registerWithEditPlugin`) et de ContextMenu (`registerProvider`). Applique le surlignage initial (`highlightAllCells`).</li>
                    <li><strong>Int√©gration Edit (`registerWithEditPlugin`, `handleRender`, `setupHighlightedEditing`):</strong>
                        <ul>
                            <li>Hook `onRender`: Intercepte le rendu du contenu de la cellule par Edit. Appelle `highlightText` pour g√©n√©rer le HTML surlign√© et l'ins√®re dans le wrapper de la cellule. Retourne `false` pour indiquer √† Edit de ne pas faire son rendu par d√©faut.</li>
                            <li>Hook `afterEdit`: Si `highlightDuringEdit` est `true`, remplace l'input standard cr√©√© par Edit par une structure `div` contenant l'input rendu transparent et une `div` de superposition (`overlay`). L'overlay affiche le texte surlign√© (`highlightText`) et est mis √† jour en temps r√©el (`input` listener) pendant que l'utilisateur tape dans l'input transparent.</li>
                        </ul>
                    </li>
                    <li><strong>Surlignage (`highlightText`, `resolveOverlaps`):</strong>
                        <ul>
                            <li>Trouve toutes les correspondances pour toutes les r√®gles actives (non-exclusion) en utilisant leurs `regex`.</li>
                            <li>Filtre les correspondances qui matchent une r√®gle d'exclusion (`isExclusion: true` ou `rule.exclusions`).</li>
                            <li>R√©sout les chevauchements (`resolveOverlaps`) en ne gardant que le match ayant la plus haute priorit√© (`group.priority`) pour chaque segment de texte.</li>
                            <li>Construit la cha√Æne HTML finale en enveloppant les correspondances non chevauchantes dans des `<span>` avec la classe `spanClass` et les styles inline (couleur, fond) d√©finis par le groupe.</li>
                        </ul>
                    </li>
                    <li><strong>Application Globale (`highlightAllCells`):</strong> Parcourt toutes les cellules √©ditables, r√©cup√®re leur valeur, appelle `highlightText`, et met √† jour le contenu du wrapper.</li>
                    <li><strong>Persistance (`loadRules`, `saveRules`):</strong> Lit/√©crit la configuration des groupes et des r√®gles dans `localStorage` au format JSON, en utilisant `storageKey`.</li>
                    <li><strong>Gestion des R√®gles (API & UI):</strong>
                        <ul>
                            <li>`addRule`, `updateRule`, `deleteRule`: Modifient le tableau `config.rules`.</li>
                            <li>`addRule` peut optionnellement envoyer la r√®gle au serveur via `fetch` si `ruleCreation.useAjax` est `true`.</li>
                            <li>Appellent `saveRules()` et `highlightAllCells()` apr√®s modification.</li>
                            <li>`showRulesManager`: Cr√©e et affiche une fen√™tre modale.</li>
                            <li>`renderRulesList`, `renderRuleItem`: G√©n√®rent le HTML pour afficher les r√®gles dans la modale.</li>
                            <li>`showAddRuleForm`, `showEditRuleForm`: G√©n√®rent les formulaires d'ajout/modification.</li>
                            <li>`exportRules`, `importRules`: G√®rent l'export/import de la configuration en JSON.</li>
                        </ul>
                    </li>
                    <li><strong>Int√©gration ContextMenu (`getMenuItems`, `executeAction`, `createRuleFromSelection`):</strong>
                        <ul>
                            <li>`getMenuItems`: Retourne les options "Activer/D√©sactiver", "G√©rer les r√®gles". Si du texte est s√©lectionn√© dans la cellule, retourne aussi des options "Ajouter une r√®gle au groupe X" pour chaque groupe (y compris "Ignor√©").</li>
                            <li>`executeAction`: G√®re les clics sur les options du menu, appelant `toggleHighlighting`, `showRulesManager`, ou `createRuleFromSelection`.</li>
                            <li>`createRuleFromSelection`: R√©cup√®re le texte s√©lectionn√©, l'√©chappe pour cr√©er une regex simple, et appelle `addRule` pour cr√©er une nouvelle r√®gle associ√©e au groupe choisi.</li>
                        </ul>
                    </li>
                </ul>
            </section>

             <section id="plugin-highlight-api">
                <h2>API Publique</h2>
                <p>
                    Si vous r√©cup√©rez l'instance du plugin via `tableInstance.getPlugin('Highlight')`, vous pouvez acc√©der aux m√©thodes suivantes :
                </p>
                 <table class="documentation-table">
                     <thead>
                         <tr><th>M√©thode</th><th>Arguments</th><th>Description</th><th>Retour</th></tr>
                     </thead>
                     <tbody>
                         <tr><td><code>getGroupById(groupId)</code></td><td><code class="attr">groupId</code> <span class="type">(string)</span></td><td>Retourne l'objet de configuration du groupe correspondant √† l'ID.</td><td class="type">object | undefined</td></tr>
                         <tr><td><code>addRule(rule)</code></td><td><code class="attr">rule</code> <span class="type">(object)</span></td><td>Ajoute une nouvelle r√®gle de surlignage. Si `ruleCreation.useAjax` est `true`, retourne une promesse r√©solue avec la r√®gle ajout√©e (potentiellement modifi√©e par le serveur) ou `null` en cas d'erreur. Sinon, retourne la r√®gle ajout√©e ou `null` si invalide.</td><td class="type">object | Promise&lt;object|null&gt; | null</td></tr>
                         <tr><td><code>updateRule(ruleId, updates)</code></td><td><code class="attr">ruleId</code> <span class="type">(string)</span>, <code class="attr">updates</code> <span class="type">(object)</span></td><td>Met √† jour une r√®gle existante identifi√©e par `ruleId` avec les propri√©t√©s fournies dans `updates`. Sauvegarde et rafra√Æchit l'affichage.</td><td class="type">boolean (succ√®s/√©chec)</td></tr>
                         <tr><td><code>deleteRule(ruleId)</code></td><td><code class="attr">ruleId</code> <span class="type">(string)</span></td><td>Supprime la r√®gle identifi√©e par `ruleId`. Sauvegarde et rafra√Æchit l'affichage.</td><td class="type">boolean (succ√®s/√©chec)</td></tr>
                         <tr><td><code>toggleHighlighting(enabled)</code></td><td><code class="attr">enabled</code> <span class="type">(boolean, optionnel)</span></td><td>Active ou d√©sactive le surlignage. Si `enabled` est omis, bascule l'√©tat actuel. Rafra√Æchit l'affichage.</td><td class="type">boolean (nouvel √©tat activ√©)</td></tr>
                         <tr><td><code>highlightAllCells()</code></td><td>-</td><td>Force le re-surlignage de toutes les cellules √©ditables.</td><td class="type">void</td></tr>
                         <tr><td><code>loadRules()</code></td><td>-</td><td>Recharge les groupes et r√®gles depuis `localStorage` (si `storageKey` est d√©fini).</td><td class="type">void</td></tr>
                         <tr><td><code>saveRules()</code></td><td>-</td><td>Sauvegarde les groupes et r√®gles actuels dans `localStorage` (si `storageKey` est d√©fini).</td><td class="type">void</td></tr>
                         <tr><td><code>showRulesManager()</code></td><td>-</td><td>Affiche la fen√™tre modale pour g√©rer les r√®gles.</td><td class="type">void</td></tr>
                         <tr><td><code>exportRules()</code></td><td>-</td><td>D√©clenche le t√©l√©chargement d'un fichier JSON contenant la configuration actuelle des groupes et r√®gles.</td><td class="type">void</td></tr>
                         <tr><td><code>importRules(callback)</code></td><td><code class="attr">callback</code> <span class="type">(function, optionnel)</span></td><td>Ouvre une bo√Æte de dialogue pour s√©lectionner un fichier JSON. Si le fichier est valide, remplace la configuration actuelle, sauvegarde, rafra√Æchit l'affichage et appelle le `callback`.</td><td class="type">void</td></tr>
                         <tr><td><code>refresh()</code></td><td>-</td><td>R√©-applique le surlignage √† toutes les cellules si le surlignage est activ√©.</td><td class="type">void</td></tr>
                     </tbody>
                 </table>
            </section>

            <section id="plugin-highlight-events">
                <h2>√âv√©nements</h2>
                <ul>
                    <li><strong>√âcout√©s :</strong>
                        <ul>
                            <li>Hooks de `Edit` (`onRender`, `afterEdit`).</li>
                            <li>√âv√©nements de l'interface utilisateur de la modale de gestion (clics, soumissions).</li>
                            <li>√âv√©nements du menu contextuel (via l'interface `ContextMenu`).</li>
                        </ul>
                    </li>
                    <li><strong>D√©clench√©s :</strong> Aucun √©v√©nement DOM sp√©cifique d√©clench√© par ce plugin. Il modifie l'affichage des cellules et interagit avec `localStorage`.</li>
                </ul>
            </section>

            <section id="plugin-highlight-example">
                <h2>Exemple Complet</h2>
                <p>Cet exemple montre une table avec une colonne de notes o√π certains mots-cl√©s et mentions sont surlign√©s.</p>

                <strong>HTML (`index.html`):</strong>
                <pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Exemple Highlight Plugin&lt;/title&gt;
    <link rel="stylesheet" href="../src/tableFlow.css"> <link rel="stylesheet" href="documentation.css"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { padding: 2rem; }
        tr.modified td { background-color: #fffbeb; }
        /* Styles Highlight */
        .tf-highlight-span { border-radius: 3px; padding: 0.1em 0; }
        /* Styles Edit */
        td.td-edit { cursor: pointer; }
        /* Styles ContextMenu */
        .tf-context-menu{position:absolute;z-index:1000;display:none;background:#fff;border:1px solid #ccc;border-radius:4px;box-shadow:0 2px 10px rgba(0,0,0,.2);padding:5px 0;min-width:180px}
        .tf-menu-item{padding:8px 15px;cursor:pointer;display:flex;align-items:center}
        .tf-menu-item:hover{background:#f5f5f5}
        .tf-menu-separator{height:1px;background:#ddd;margin:5px 0}
        .tf-menu-header{padding:5px 10px;font-weight:700;color:#666;font-size:.9em}
        .menu-icon{margin-right:8px;font-size:1.1em;width:20px;text-align:center}
        /* Styles Modale */
        .tf-highlight-modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:600px;max-width:90%;max-height:80vh;background-color:#fff;border:1px solid #ccc;border-radius:5px;box-shadow:0 4px 12px rgba(0,0,0,.2);padding:20px;z-index:2000;overflow:auto}
        .tf-modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);z-index:1999}
        .tf-modal-close{background:0 0;border:none;font-size:20px;cursor:pointer;float:right}
        .tf-rules-container{margin-bottom:20px;max-height:300px;overflow-y:auto;border:1px solid #eee;padding:10px}
        .tf-highlight-button{padding:8px 16px;border:none;border-radius:4px;cursor:pointer;color:#fff}
        .tf-highlight-button.add{background:#4caf50}
        .tf-highlight-button.export{background:#2196f3;margin-right:8px}
        .tf-highlight-button.import{background:#ff9800}
        .tf-rule-item{display:flex;align-items:center;padding:10px;border-bottom:1px solid #eee;margin-bottom:8px}
        .tf-rule-item-regex{flex:1;font-family:monospace;font-size:.9em;margin-right:10px}
        .tf-rule-item-actions button{background:0 0;border:1px solid #ddd;border-radius:3px;padding:3px 8px;cursor:pointer;margin-left:5px}
    </style>
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;TableFlow - Exemple Plugin Highlight&lt;/h1&gt;
    &lt;p&gt;Double-cliquez pour √©diter. Clic droit pour le menu.&lt;/p&gt;

    &lt;table id="notesTable"&gt;
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th id="noteId" th-noreorder&gt;ID&lt;/th&gt;
                &lt;th id="noteText" th-edit&gt;Note (√âditable & Surlignable)&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
            &lt;tr id="n1"&gt;
                &lt;td id="noteId_n1"&gt;1&lt;/td&gt;
                &lt;td id="noteText_n1"&gt;T√¢che urgente: contacter @bob avant midi. C'est important! TODO: v√©rifier email.&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr id="n2"&gt;
                &lt;td id="noteId_n2"&gt;2&lt;/td&gt;
                &lt;td id="noteText_n2"&gt;Id√©e pour @alice: utiliser le composant critique existant.&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/tbody&gt;
    &lt;/table&gt;

    &lt;script type="module"&gt;
        import TableFlow from '../src/tableFlow.js'; // Ajustez

        const notesTable = new TableFlow({
            tableId: 'notesTable',
            pluginsPath: '../plugins', // Ajustez
            debug: true,
            plugins: {
                names: ['Edit', 'ContextMenu', 'Highlight'],
                highlight: {
                    storageKey: 'myAppNotesHighlight', // Cl√© sp√©cifique
                    groups: [
                        { id: 'urgent', name: 'Urgent', color: 'white', backgroundColor: 'red', priority: 0 },
                        { id: 'keyword', name: 'Mot-Cl√©', color: 'white', backgroundColor: 'blue', priority: 1 },
                        { id: 'mention', name: 'Mention', color: 'purple', backgroundColor: '#f3e8ff', priority: 2 },
                        { id: 'ignored', name: 'Ignor√©', isExclusion: true, priority: 10 }
                    ],
                    rules: [
                        // R√®gles initiales (seront charg√©es/sauvegard√©es via localStorage)
                        { id: 'r_urgent', group: 'urgent', regex: '\\b(urgent|critique)\\b', enabled: true },
                        { id: 'r_keyword', group: 'keyword', regex: '\\b(important|contacter)\\b', enabled: true },
                        { id: 'r_mention', group: 'mention', regex: '@[\\w-]+', enabled: true },
                        { id: 'r_ignore_todo', group: 'ignored', regex: 'TODO\\s*:', enabled: true }
                    ],
                    menuEnabled: true,
                    ruleCreation: { enabled: true },
                    ui: { allowExport: true, allowImport: true }
                },
                edit: { /* Config par d√©faut */ },
                contextmenu: { /* Config par d√©faut */ }
            }
        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

                <strong>Fonctionnement de l'exemple :</strong>
                <ol>
                    <li>Au chargement, les mots "urgente", "important", "critique", "contacter" et les mentions "@bob", "@alice" sont surlign√©s avec les couleurs de leurs groupes respectifs. "TODO :" n'est pas surlign√© car il correspond √† une r√®gle d'exclusion.</li>
                    <li>Si vous double-cliquez sur une note, le surlignage devrait √™tre maintenu pendant l'√©dition (si `highlightDuringEdit` est `true`).</li>
                    <li>Faites un clic droit sur une note :
                        <ul>
                            <li>Le menu "Surlignage" appara√Æt.</li>
                            <li>Vous pouvez activer/d√©sactiver le surlignage globalement.</li>
                            <li>Vous pouvez cliquer sur "G√©rer les r√®gles de surlignage" pour ouvrir la modale.</li>
                            <li>Si vous s√©lectionnez du texte (ex: "midi") avant le clic droit, des options "Ajouter une r√®gle au groupe X" appara√Ætront. Cliquer sur l'une d'elles cr√©era une r√®gle pour surligner "midi" avec le style du groupe choisi.</li>
                        </ul>
                    </li>
                    <li>Dans la modale "G√©rer les r√®gles" :
                        <ul>
                            <li>Vous voyez les r√®gles existantes, group√©es par couleur.</li>
                            <li>Vous pouvez activer/d√©sactiver, modifier (‚úèÔ∏è) ou supprimer (üóëÔ∏è) chaque r√®gle.</li>
                            <li>Vous pouvez ajouter une nouvelle r√®gle via le bouton.</li>
                            <li>Vous pouvez exporter la configuration actuelle (groupes + r√®gles) en JSON.</li>
                            <li>Vous pouvez importer une configuration depuis un fichier JSON.</li>
                        </ul>
                    </li>
                    <li>Toutes les modifications de r√®gles sont sauvegard√©es dans le `localStorage` (cl√© `myAppNotesHighlight`) et appliqu√©es imm√©diatement au tableau.</li>
                </ol>
            </section>

        </div>
    </div>
</body>
</html>