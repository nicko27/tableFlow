<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation Exhaustive TableFlow</title>
    <link rel="stylesheet" href="documentation.css"> <link rel="stylesheet" href="../src/tableFlow.css"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"> <style>
        /* Styles spécifiques pour les exemples */
        #exempleTableComplex tr.modified td { background-color: #fffbeb; }
        #exempleTableComplex tr.highlight td { background-color: #d1fae5 !important; }
        #exempleTableComplex tr.error-row td { background-color: #fee2e2 !important; }
        #exempleTableComplex td.invalid { background-color: #fee2e2 !important; outline: 1px solid #f8d7da; }
        #exempleTableComplex .validation-error { color: #dc3545; font-size: 0.8em; margin-top: 4px; display: none; }
        #exempleTableComplex td.invalid .validation-error { display: block; }
        #exempleTableComplex .tf-color-wrapper{display:flex;align-items:center;gap:5px;}
        #exempleTableComplex .color-preview{width:20px;height:20px;border:1px solid #ccc;border-radius:4px;cursor:pointer}
        #exempleTableComplex .color-input{width:80px;text-align:center;border:1px solid #ccc;border-radius:4px;padding:3px 5px;font-size:inherit}
        #exempleTableComplex th.reorderable-column{position:relative;cursor:grab}
        #exempleTableComplex .column-drag-handle{cursor:grab;color:#999;padding:0 5px}
        #globalFilterInputExemple { margin-bottom: 1em; padding: 0.5em; border: 1px solid #ccc; border-radius: 4px; }
        .pagination-container { margin-top: 1em; }
    </style>
</head>
<body>
    <div class="container">
        <nav class="nav">
            <h3>TableFlow</h3>
            <ul>
                <li><a href="#introduction">Introduction</a></li>
                <li><a href="#installation">Installation</a></li>
                <li><a href="#initialisation">Initialisation</a></li>
                <li><a href="#core-concepts">Concepts Clés</a></li>
                <li><a href="#architecture">Architecture</a></li>
                <li><a href="#core-api">API Principale</a></li>
                <li><a href="#plugins-overview">Plugins Disponibles</a>
                    <ul>
                        <li><a href="actions.html">Actions</a></li>
                        <li><a href="choice.html">Choice</a></li>
                        <li><a href="color.html">Color</a></li>
                        <li><a href="columnreorder.html">ColumnReorder</a></li>
                        <li><a href="contextmenu.html">ContextMenu</a></li>
                        <li><a href="edit.html">Edit</a></li>
                        <li><a href="filterandpaginate.html">Filter & Paginate</a></li>
                        <li><a href="highlight.html">Highlight</a></li>
                        <li><a href="hide.html">Hide</a></li>
                        <li><a href="linetoggle.html">LineToggle</a></li>
                        <li><a href="#">Select (Alternative)</a></li>
                        <li><a href="#">Selection</a></li>
                        <li><a href="#">Sort</a></li>
                        <li><a href="texteditor.html">TextEditor</a></li>
                        <li><a href="validation.html">Validation</a></li>
                    </ul>
                </li>
                <li><a href="#exemples-complets">Exemples Complets</a>
                    <ul>
                        <li><a href="#exemple-gestion-taches">Gestion de Tâches</a></li>
                        <li><a href="#exemple-catalogue-produits">Catalogue Produits</a></li>
                    </ul>
                </li>
            </ul>
        </nav>

        <div class="content">
            <h1>Documentation TableFlow</h1>

            <section id="introduction">
                <h2>Introduction</h2>
                <p>
                    TableFlow est une bibliothèque JavaScript modulaire conçue pour transformer des tableaux HTML standard (<code>&lt;table&gt;</code>)
                    en composants interactifs et riches en fonctionnalités. Son objectif principal est de fournir une base
                    extensible pour manipuler et interagir avec des données tabulaires directement dans le navigateur,
                    en minimisant le besoin de code JavaScript complexe côté utilisateur pour des tâches courantes.
                </p>
                <p>
                    Grâce à son système de plugins, vous pouvez ajouter sélectivement des capacités telles que l'édition en ligne, la validation, le tri, le filtrage, la pagination, les actions personnalisées, la sélection de valeurs, la réorganisation des colonnes, le surlignage de texte, et bien plus encore.
                </p>
                 <p>
                    L'approche de TableFlow est souvent déclarative : de nombreuses fonctionnalités sont activées et
                    configurées via des attributs HTML spécifiques placés sur les éléments <code>&lt;th&gt;</code>
                    de votre tableau, complétés par une configuration JavaScript pour les options plus complexes
                    et la logique métier (comme les handlers d'action).
                </p>
            </section>

            <section id="installation">
                <h2>Installation</h2>
                <p>
                    TableFlow utilise les modules ES6. Incluez <code>tableFlow.js</code>, les plugins désirés, et les CSS nécessaires.
                </p>
                <pre><code class="language-html">&lt;!-- 1. CSS TableFlow + Documentation (ou votre propre style) --&gt;
&lt;link rel="stylesheet" href="path/to/src/tableFlow.css"&gt;
&lt;link rel="stylesheet" href="path/to/docs/documentation.css"&gt;

&lt;!-- 2. FontAwesome (Optionnel, pour icônes par défaut) --&gt;
&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"&gt;

&lt;!-- 3. Dépendances externes (Ex: ColorFlow pour plugin Color) --&gt;
&lt;!-- &lt;script src="path/to/colorFlow/src/colorFlow.js"&gt;&lt;/script&gt; --&gt;

&lt;!-- 4. Votre table HTML avec un ID et des attributs th-* --&gt;
&lt;table id="maSuperTable"&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th id="col1" th-sort&gt;Colonne Triable&lt;/th&gt;
      &lt;th id="col2" th-edit th-validate='{"required":true}'&gt;Colonne Éditable&lt;/th&gt;
      &lt;th id="col3" th-choice='["A","B"]'&gt;Choix&lt;/th&gt;
      &lt;th id="col4" th-actions="save,delete"&gt;Actions&lt;/th&gt;
      &lt;!-- ... --&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;&lt;!-- Données --&gt;&lt;/tbody&gt;
&lt;/table&gt;

&lt;!-- 5. Initialisation via script module --&gt;
&lt;script type="module"&gt;
  import TableFlow from './path/to/src/tableFlow.js'; // Ajustez

  const maTableInstance = new TableFlow({
    tableId: 'maSuperTable',
    pluginsPath: './path/to/plugins', // Ajustez
    plugins: {
        names: ['Sort', 'Edit', 'Validation', 'Choice', 'Actions'],
        // ... configuration spécifique des plugins ...
    }
  });
&lt;/script&gt;</code></pre>
                 <div class="info-block">
                    <strong>Important :</strong> Le chemin `pluginsPath` est relatif à l'emplacement de `tableFlow.js`. Assurez-vous que les fichiers JS des plugins sont accessibles. L'attribut `type="module"` est essentiel.
                </div>
            </section>

            <section id="initialisation">
                <h2>Initialisation</h2>
                <p>
                    Créez une instance de `TableFlow` avec un objet de configuration.
                </p>
                <pre><code class="language-javascript">// Voir exemple détaillé dans la section Installation</code></pre>
                <h3>Options d'Initialisation Principales</h3>
                <p>Les options principales sont passées lors de la création de `new TableFlow(options)`.</p>
                <table class="documentation-table">
                    <thead>
                        <tr><th>Option</th><th>Type</th><th>Défaut</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code class="attr">tableId</code></td><td class="type">string</td><td><i>Requis</i></td><td>ID de l'élément <code>&lt;table&gt;</code> HTML.</td></tr>
                        <tr><td><code class="attr">plugins</code></td><td class="type">object</td><td><code>{}</code></td><td>Objet pour configurer les plugins : <code>{ names: ['Plugin1', 'Plugin2'], plugin1: { /* config */ }, plugin2: { /* config */ } }</code>.</td></tr>
                        <tr><td><code class="attr">pluginsPath</code></td><td class="type">string</td><td><code>'../plugins'</code></td><td>Chemin relatif (depuis `tableFlow.js`) vers le dossier des fichiers <code>.js</code> des plugins.</td></tr>
                        <tr><td><code class="attr">debug</code></td><td class="type">boolean</td><td><code class="default">false</code></td><td>Active les logs de débogage globaux pour TableFlow et les plugins (peut être surchargé par la config de chaque plugin).</td></tr>
                        <tr><td><code class="attr">notifications</code></td><td class="type">object</td><td><code>{...}</code></td><td>Permet de brancher un système de notification externe (ex: toasts) avec des fonctions pour `info`, `warning`, `success`, `error`.</td></tr>
                        <tr><td><code class="attr">onSort</code>, <code>onFilter</code>, etc.</td><td class="type">function</td><td><code>null</code></td><td>Callbacks globaux déclenchés par certains événements. Moins utilisés car la logique est souvent dans les handlers de plugins.</td></tr>
                    </tbody>
                </table>
                 <div class="info-block">
                    <strong>Note sur les Wrappers :</strong> Les options `cellWrapper`, `headWrapper`, `cellWrapperClass`, `headWrapperClass` ne sont plus directement dans `TableFlow`. La gestion des wrappers est maintenant assurée par `TableInstance` (via `instanceManager.js`), qui a ses propres options (`wrapCellsEnabled`, `wrapHeadersEnabled`, etc.) si vous utilisez cette architecture avancée. Pour une utilisation simple de `TableFlow`, les wrappers sont généralement activés par défaut.
                </div>
            </section>

            <section id="core-concepts">
                <h2>Concepts Clés Détaillés</h2>
                <ul>
                    <li>
                        <strong>Approche Modulaire (Plugins) :</strong> Chaque fonctionnalité (tri, édition, etc.) est un plugin indépendant (`.js` + potentiellement `.css`). Vous activez uniquement ceux nécessaires via `plugins.names`. Cela garde le code léger et organisé. Les plugins sont chargés dynamiquement via `import()`.
                    </li>
                    <li>
                        <strong>Configuration Déclarative (Attributs `th-*`) :</strong> Moyen simple et lisible d'activer et de configurer des fonctionnalités au niveau des colonnes directement dans le HTML. Exemples :
                        <ul>
                            <li><code>th-sort</code>: Active le tri.</li>
                            <li><code>th-edit</code>: Active l'édition.</li>
                            <li><code>th-validate='{...}'</code>: Définit les règles de validation (JSON).</li>
                            <li><code>th-choice='[...] / {...}' / "type"</code>: Configure le plugin Choice.</li>
                            <li><code>th-actions="save,delete"</code>: Définit les boutons d'action.</li>
                            <li><code>th-color</code>: Active le sélecteur de couleur.</li>
                            <li><code>th-hide</code>: Masque la colonne.</li>
                            <li><code>th-linetoggle='[...]'</code>: Définit les règles de style de ligne.</li>
                            <li><code>th-noreorder</code>: Exclut la colonne de la réorganisation.</li>
                            <li><code>th-sql-exclude</code>: Exclut la colonne de `getRowData`.</li>
                        </ul>
                    </li>
                    <li>
                        <strong>Configuration Programmatique (Options JS) :</strong> Pour les options globales, les configurations complexes (listes dynamiques, handlers d'actions) et pour surcharger/préciser les configurations HTML. Se fait dans l'objet `plugins` lors de l'instanciation `new TableFlow(options)`.
                    </li>
                    <li>
                        <strong>Gestion de l'État (`data-*`, classe `modified`) :</strong>
                        <ul>
                            <li><code>data-initial-value</code>: Stocke la valeur "propre" d'une cellule (au chargement ou après sauvegarde). Essentiel pour détecter les modifications.</li>
                            <li><code>data-value</code>: Stocke la valeur sémantique *actuelle* (peut différer du texte affiché). Utilisé par les plugins d'édition/choix pour la logique interne et la sauvegarde.</li>
                            <li>Classe `modified`: Appliquée à `<tr>` si `data-value` != `data-initial-value` pour au moins une cellule. Permet un retour visuel et le déclenchement conditionnel d'actions (ex: bouton "Sauvegarder").</li>
                        </ul>
                    </li>
                     <li>
                        <strong>Wrappers (`cell-wrapper`, `head-wrapper`) :</strong> Divs ajoutés autour du contenu des `<td>` et `<th>`. Cruciaux pour que les plugins puissent manipuler le contenu (remplacer par un input, ajouter des boutons/icônes) sans casser la structure de la cellule. Facilitent aussi le style (ex: alignement vertical). Gérés par `TableInstance` ou activés par défaut dans `TableFlow`.
                    </li>
                    <li>
                        <strong>Système d'Événements (DOM Personnalisés) :</strong> Communication inter-plugins et avec l'extérieur via des événements émis sur l'élément `<table>`. Permet le découplage. Exemples:
                        <ul>
                            <li>`cell:change` (par Edit, Choice, Color, TextEditor...)</li>
                            <li>`row:saved` (par `markRowAsSaved`, souvent appelé par Actions)</li>
                            <li>`row:added` / `row:removed` (par `addRow`/`removeRow`)</li>
                            <li>`sortAppened` (par Sort)</li>
                            <li>`pageChanged` (par FilterAndPaginate)</li>
                            <li>`column:reordered` (par ColumnReorder)</li>
                            <li>... et potentiellement d'autres événements spécifiques aux plugins.</li>
                        </ul>
                    </li>
                    <li>
                        <strong>API Core (`TableFlow` instance) :</strong> Fournit des méthodes pour manipuler la table (`addRow`, `removeRow`, `getRowData`), gérer l'état (`markRowAsSaved`), interagir avec les plugins (`getPlugin`, `refreshPlugins`), et notifier (`notify`).
                    </li>
                </ul>
            </section>

             <section id="architecture">
                <h2>Architecture Détaillée</h2>
                <p>L'architecture repose sur l'interaction entre `TableFlow`, `PluginRegistry`, `InstanceManager`, `TableInstance`, et `InstancePluginManager`.</p>
                <ol>
                    <li><strong>`TableFlow` (`src/tableFlow.js`):</strong> Point d'entrée principal. Gère les options de haut niveau, charge les plugins via `import()` et les instancie. Stocke les valeurs initiales (`initialValues` Map). Fournit l'API publique.</li>
                    <li><strong>`PluginRegistry` (`src/pluginRegistry.js`):</strong> Singleton. Catalogue central des définitions de plugins. Gère le chargement asynchrone (`load`) des fichiers de plugins via `import()` et évite les chargements multiples. Valide l'interface (`init`, `destroy`) et le type (`PluginType`) des plugins.</li>
                    <li><strong>`InstanceManager` (`src/instanceManager.js`):</strong> Singleton. Gère potentiellement plusieurs instances de tables sur une même page. Chaque instance est un objet `TableInstance`. Fournit des méthodes pour créer/récupérer/détruire ces instances.</li>
                    <li><strong>`TableInstance` (dans `src/instanceManager.js`):</strong> Représentation interne d'une table gérée. Contient sa propre configuration (qui peut inclure l'activation/désactivation des wrappers), la référence à l'élément DOM, et son propre `InstancePluginManager`. C'est elle qui gère l'initialisation effective des wrappers et l'appel à `init()` des plugins.</li>
                    <li><strong>`InstancePluginManager` (`src/instancePluginManager.js`):</strong> Chaque `TableInstance` en a un. Gère le cycle de vie des plugins *pour cette instance spécifique*. Utilise `PluginRegistry` pour charger le code, puis instancie et initialise le plugin en lui passant la référence à la `TableInstance`.</li>
                    <li><strong>Plugins (`plugins/*.js`):</strong> Classes autonomes respectant l'interface (`init`, `destroy`, `refresh` optionnel). Reçoivent la référence à l'instance `TableFlow`/`TableInstance` dans `init()` pour interagir avec la table et les autres plugins.</li>
                </ol>
                 <div class="info-block">
                    <strong>Flux d'Initialisation (Précisé) :</strong>
                    <ol>
                        <li>`new TableFlow(options)` crée l'instance principale.</li>
                        <li>`TableFlow` appelle `loadPlugins()`.</li>
                        <li>Pour chaque nom dans `options.plugins.names`:
                            <ul>
                                <li>`import(pluginPath)` charge le module JS du plugin.</li>
                                <li>`new pluginModule.default(mergedConfig)` instancie le plugin.</li>
                                <li>`pluginInstance.init(thisTableFlowInstance)` est appelé.</li>
                            </ul>
                        </li>
                        <li>Dans `pluginInstance.init(tableHandler)`:
                            <ul>
                                <li>Le plugin stocke `tableHandler`.</li>
                                <li>Il configure ses écouteurs (ex: `tableHandler.table.addEventListener(...)`).</li>
                                <li>Il modifie le DOM si nécessaire (ajoute classes, poignées, etc.).</li>
                                <li>Il peut récupérer d'autres plugins via `tableHandler.getPlugin(...)` pour interagir ou s'enregistrer (ex: `ContextMenu.registerProvider(this)`).</li>
                            </ul>
                        </li>
                    </ol>
                     <p>L'utilisation de `InstanceManager` et `TableInstance` semble être une couche d'abstraction supplémentaire potentielle, mais l'initialisation décrite dans `TableFlow.js` charge et initialise directement les plugins.</p>
                </div>
            </section>

            <section id="core-api">
                 <h2>API Principale (Méthodes de l'instance <code>TableFlow</code>)</h2>
                 <p>Voici les méthodes les plus utiles disponibles sur l'objet retourné par `new TableFlow(...)`:</p>
                 <table class="documentation-table">
                     <thead>
                         <tr><th>Méthode</th><th>Arguments</th><th>Description</th><th>Retour</th></tr>
                     </thead>
                     <tbody>
                         <tr><td><code>getVisibleRows()</code></td><td>-</td><td>Retourne un tableau des éléments <code>&lt;tr&gt;</code> du `tbody` actuellement visibles (prend en compte le filtrage du plugin FilterAndPaginate, par exemple).</td><td class="type">Array&lt;HTMLTableRowElement&gt;</td></tr>
                         <tr><td><code>getAllRows()</code></td><td>-</td><td>Retourne un tableau de tous les éléments <code>&lt;tr&gt;</code> du <code>&lt;tbody&gt;</code>, qu'ils soient visibles ou non.</td><td class="type">Array&lt;HTMLTableRowElement&gt;</td></tr>
                         <tr><td><code>getHeaderCell(columnIndex)</code></td><td><code class="attr">columnIndex</code> <span class="type">(number)</span></td><td>Retourne l'élément <code>&lt;th&gt;</code> à l'index de colonne spécifié.</td><td class="type">HTMLTableCellElement | null</td></tr>
                         <tr><td><code>isEditable()</code></td><td>-</td><td>Vérifie si la table est globalement éditable (basé sur l'attribut `th-readonly` sur <code>&lt;table&gt;</code> - *Note: non standardisé*). Actuellement retourne `true` par défaut.</td><td class="type">boolean</td></tr>
                         <tr><td><code>isRowModified(row)</code></td><td><code class="attr">row</code> <span class="type">(HTMLTableRowElement)</span></td><td>Vérifie si une ligne a été modifiée en comparant les `data-value` actuels avec les `data-initial-value` stockés, ou en vérifiant la présence de la classe `modified`.</td><td class="type">boolean</td></tr>
                         <tr><td><code>markRowAsModified(row)</code></td><td><code class="attr">row</code> <span class="type">(HTMLTableRowElement)</span></td><td>Ajoute ou retire la classe `modified` à la ligne en fonction de `isRowModified`.</td><td class="type">void</td></tr>
                         <tr><td><code>updateCellValue(row, columnId, value)</code></td><td><code class="attr">row</code> <span class="type">(HTMLTableRowElement)</span>, <code class="attr">columnId</code> <span class="type">(string)</span>, <code class="attr">value</code> <span class="type">(any)</span></td><td>Met à jour le contenu textuel de la cellule (via son wrapper si présent) et appelle `markRowAsModified`. <strong>Attention:</strong> Ne met pas à jour `data-value` ou `data-initial-value`, ni ne déclenche `cell:change`. Préférez les méthodes des plugins (Edit, Choice) pour des mises à jour complètes.</td><td class="type">void</td></tr>
                         <tr><td><code>markRowAsSaved(row, options)</code></td><td><code class="attr">row</code> <span class="type">(HTMLTableRowElement)</span>, <code class="attr">options</code> <span class="type">(object, optionnel)</span></td><td>Marque une ligne comme sauvegardée : copie les `data-value` actuels vers `data-initial-value` (via `initialValues` map), retire la classe `modified` de la ligne, notifie les plugins via `plugin.markRowAsSaved(row, options)`, et déclenche l'événement `row:saved` (en passant l'`options`).</td><td class="type">void</td></tr>
                         <tr><td><code>addRow(data, position)</code></td><td><code class="attr">data</code> <span class="type">(Array|Object, optionnel)</span>, <code class="attr">position</code> <span class="type">(string, 'start'|'end')</span></td><td>Ajoute une nouvelle ligne au tableau. `data` peut être un tableau de valeurs (ordre des colonnes) ou un objet `{ columnId: value }`. `position` (défaut: 'end'). Injecte le HTML, initialise les wrappers/valeurs, déclenche `row:added` et appelle `refreshPlugins()`.</td><td class="type">HTMLTableRowElement</td></tr>
                         <tr><td><code>removeRow(row)</code></td><td><code class="attr">row</code> <span class="type">(HTMLTableRowElement | string ID)</span></td><td>Supprime une ligne (élément TR ou par son ID) du tableau. Déclenche `row:removing` avant et `row:removed` après. Appelle `refreshPlugins()`.</td><td class="type">boolean</td></tr>
                         <tr><td><code>getRowData(row)</code></td><td><code class="attr">row</code> <span class="type">(HTMLTableRowElement | string ID)</span></td><td>Récupère les données d'une ligne (élément TR ou par son ID) sous forme d'objet `{ columnId: value }`. Utilise `data-value` si présent, sinon le contenu textuel (via le wrapper si activé). Exclut les colonnes d'actions et celles marquées `th-sql-exclude`. Ajoute `id` si la ligne a un ID. Tente des conversions de type basiques (nombre, booléen).</td><td class="type">object</td></tr>
                         <tr><td><code>refreshPlugins()</code></td><td>-</td><td>Appelle la méthode `refresh()` (si elle existe) sur tous les plugins actifs, en respectant l'ordre des dépendances si défini par les plugins.</td><td class="type">void</td></tr>
                         <tr><td><code>destroy()</code></td><td>-</td><td>Nettoie l'instance TableFlow : appelle `destroy()` sur tous les plugins actifs, nettoie les références internes, et supprime les écouteurs d'événements ajoutés par le cœur (si applicable). Ne supprime pas l'élément table du DOM.</td><td class="type">void</td></tr>
                         <tr><td><code>hasPlugin(name)</code></td><td><code class="attr">name</code> <span class="type">(string)</span></td><td>Vérifie si un plugin (par son nom exact, ex: 'Sort') est actif pour cette instance.</td><td class="type">boolean</td></tr>
                         <tr><td><code>getPlugin(name)</code></td><td><code class="attr">name</code> <span class="type">(string)</span></td><td>Retourne l'instance d'un plugin actif, permettant d'appeler ses méthodes publiques spécifiques si besoin.</td><td class="type">object | null</td></tr>
                         <tr><td><code>notify(type, message)</code></td><td><code class="attr">type</code> <span class="type">(string)</span>, <code class="attr">message</code> <span class="type">(string)</span></td><td>Affiche une notification en utilisant le système configuré dans les options `notifications` (ex: 'info', 'error').</td><td class="type">void</td></tr>
                     </tbody>
                 </table>
             </section>

            <section id="plugins-overview">
                <h2>Plugins Disponibles (Synthèse)</h2>
                <p>Voici un aperçu des plugins fournis. Cliquez sur le nom pour accéder à la documentation détaillée.</p>

                <ul>
                    <li>
                        <strong><a href="actions.html">Actions</a></strong>
                        <p>Ajoute des boutons d'action par ligne. Configuré via `th-actions="action1,..."` et `plugins.actions` (handlers, icônes, showOnChange).</p>
                    </li>
                    <li>
                        <strong><a href="choice.html">Choice</a></strong>
                        <p>Sélection de valeurs prédéfinies (toggle ou dropdown/search). Configuré via `th-choice` et `plugins.choice.columns` (type, values, readOnlyValues).</p>
                    </li>
                    <li>
                        <strong><a href="color.html">Color</a></strong>
                        <p>Sélecteur de couleur. Nécessite une bibliothèque externe (ColorFlow). Activé via `th-color`. Options JS minimes (`plugins.color`).</p>
                    </li>
                     <li>
                        <strong><a href="columnreorder.html">ColumnReorder</a></strong>
                        <p>Réorganisation des colonnes par glisser-déposer. Exclure avec `th-noreorder`. Configuré via `plugins.columnreorder` (poignée, persistance, callbacks).</p>
                    </li>
                     <li>
                        <strong><a href="contextmenu.html">ContextMenu</a></strong>
                        <p>Framework pour menu contextuel. D'autres plugins s'y enregistrent (`registerProvider`) pour ajouter des options. Configuré via `plugins.contextmenu` (classes CSS).</p>
                    </li>
                    <li>
                        <strong><a href="edit.html">Edit</a></strong>
                        <p>Édition en ligne par double-clic. Activé via `th-edit`. Intègre la validation via `th-validate`. Configuré via `plugins.edit` (classes, validateurs).</p>
                    </li>
                    <li>
                        <strong><a href="filterandpaginate.html">Filter & Paginate</a></strong>
                        <p>Filtrage global et pagination côté client. Nécessite un `<input>` externe. Configuré via `plugins.filterandpaginate` (sélecteur filtre, taille page, classes, labels).</p>
                    </li>
                     <li>
                        <strong><a href="highlight.html">Highlight</a></strong>
                        <p>Surligne du texte selon des règles regex et des groupes. Gère les priorités, exclusions, persistance, UI de gestion. Intégré à Edit et ContextMenu. Configuré via `plugins.highlight` (groups, rules, UI).</p>
                    </li>
                    <li>
                        <strong><a href="hide.html">Hide</a></strong>
                        <p>Masque des colonnes au chargement. Activé via `th-hide`. Pas de config JS. API pour `showColumn`/`hideColumn`.</p>
                    </li>
                    <li>
                        <strong><a href="linetoggle.html">LineToggle</a></strong>
                        <p>Modifie les classes CSS d'une ligne (`<tr>`) selon la valeur d'une cellule. Configuré via `th-linetoggle` (JSON) et/ou `plugins.linetoggle.rules` (conditions, addClass, removeClass).</p>
                    </li>
                     <li>
                        <strong><a href="#">Select (Alternative)</a></strong>
                        <p><em>(Doc à venir)</em> Alternative à Choice pour un dropdown avec recherche, potentiellement pour de grandes listes. Activé via `th-select`. Configuré via `plugins.select.options`.</p>
                    </li>
                     <li>
                        <strong><a href="#">Selection</a></strong>
                        <p><em>(Doc à venir)</em> Sélection avancée (cellules, lignes, colonnes) avec souris/clavier et menu contextuel optionnel. Configuré via `plugins.selection` (mode, classes, callbacks).</p>
                    </li>
                     <li>
                        <strong><a href="#">Sort</a></strong>
                        <p><em>(Doc à venir)</em> Tri des colonnes au clic sur l'en-tête. Activé via `th-sort`. Configuré via `plugins.sort` (icônes, ignoreCase).</p>
                    </li>
                     <li>
                        <strong><a href="texteditor.html">TextEditor</a></strong>
                        <p>Extension pour Edit/ContextMenu ajoutant des actions de manipulation de texte (suppr phrase, regex, majuscules...). Configuré via `plugins.texteditor` (actions, shortcuts).</p>
                    </li>
                    <li>
                        <strong><a href="validation.html">Validation</a></strong>
                        <p>Extension pour Edit. Valide les données avant sauvegarde selon des règles (`th-validate` et `plugins.validation.validators`).</p>
                    </li>
                </ul>
            </section>

            <section id="exemples-complets">
                <h2>Exemples Complets</h2>
                <p>Ces exemples montrent comment combiner plusieurs plugins pour créer des tableaux interactifs.</p>

                <article id="exemple-gestion-taches">
                    <h3>Exemple 1 : Tableau de Gestion de Tâches</h3>
                    <p>Combine Edit, Validation, Choice, LineToggle, Actions, ContextMenu, TextEditor, Sort, ColumnReorder, Hide.</p>

                    <div class="example">
                        <div class="example-preview">
                             <table id="exempleTableTaches">
                                 <thead>
                                     <tr>
                                         <th id="tacheId" th-hide>ID</th>
                                         <th id="tacheDesc" th-edit>Description</th>
                                         <th id="tacheStatut" th-choice th-linetoggle>Statut</th>
                                         <th id="tachePrio" th-choice="toggle" th-sort>Priorité</th>
                                         <th id="tacheEcheance" th-edit th-validate='{"date": true}'>Échéance</th>
                                         <th id="tacheActions" th-actions="save,delete">Actions</th>
                                     </tr>
                                 </thead>
                                 <tbody>
                                     <tr id="task-1">
                                         <td id="tacheId_task-1">1</td>
                                         <td id="tacheDesc_task-1">Finaliser le rapport mensuel. Vérifier les chiffres avec @compta.</td>
                                         <td id="tacheStatut_task-1" data-value="in_progress">En cours</td>
                                         <td id="tachePrio_task-1" data-value="Haute">Haute</td>
                                         <td id="tacheEcheance_task-1" data-value="2025-05-10">2025-05-10</td>
                                         <td id="tacheActions_task-1"></td>
                                     </tr>
                                      <tr id="task-2">
                                         <td id="tacheId_task-2">2</td>
                                         <td id="tacheDesc_task-2">Préparer la démo client. TODO: Ajouter slides sur nouvelle feature.</td>
                                         <td id="tacheStatut_task-2" data-value="pending">En attente</td>
                                         <td id="tachePrio_task-2" data-value="Moyenne">Moyenne</td>
                                         <td id="tacheEcheance_task-2" data-value="2025-05-15">2025-05-15</td>
                                         <td id="tacheActions_task-2"></td>
                                     </tr>
                                      <tr id="task-3">
                                         <td id="tacheId_task-3">3</td>
                                         <td id="tacheDesc_task-3">Corriger bug #456 (urgent).</td>
                                         <td id="tacheStatut_task-3" data-value="error">Erreur Bloquante</td>
                                         <td id="tachePrio_task-3" data-value="Haute">Haute</td>
                                         <td id="tacheEcheance_task-3" data-value=""></td>
                                         <td id="tacheActions_task-3"></td>
                                     </tr>
                                      <tr id="task-4">
                                         <td id="tacheId_task-4">4</td>
                                         <td id="tacheDesc_task-4">Archivage projet Y.</td>
                                         <td id="tacheStatut_task-4" data-value="completed">Terminé</td>
                                         <td id="tachePrio_task-4" data-value="Basse">Basse</td>
                                         <td id="tacheEcheance_task-4" data-value="2025-04-30">2025-04-30</td>
                                         <td id="tacheActions_task-4"></td>
                                     </tr>
                                 </tbody>
                             </table>
                             </div>
                        <div class="example-code">
                            <pre><code class="language-javascript">// Initialisation TableFlow pour l'exemple de tâches
import TableFlow from '../src/tableFlow.js'; // Ajustez

const tachesTable = new TableFlow({
    tableId: 'exempleTableTaches',
    pluginsPath: '../plugins', // Ajustez
    debug: true,
    plugins: {
        names: [
            'Hide', 'Edit', 'Validation', 'Choice', 'LineToggle',
            'Actions', 'ContextMenu', 'TextEditor', 'Sort', 'ColumnReorder'
            // 'FilterAndPaginate' // Pourrait être ajouté
        ],
        // Config Edit & Validation (pour Échéance)
        edit: { }, // Utilise th-edit
        validation: { }, // Utilise th-validate

        // Config Choice (pour Statut et Priorité)
        choice: {
            columns: {
                'tacheStatut': {
                    type: 'searchable', // Dropdown avec recherche
                    values: [
                        { value: 'pending', label: 'En attente' },
                        { value: 'in_progress', label: 'En cours' },
                        { value: 'completed', label: 'Terminé' },
                        { value: 'error', label: 'Erreur Bloquante' }
                    ],
                     readOnlyValues: [ { value: 'archived', class: 'readonly-locked' } ] // Exemple
                },
                'tachePrio': {
                    type: 'toggle', // Clic pour changer
                    values: ['Basse', 'Moyenne', 'Haute']
                }
            }
        },

        // Config LineToggle (pour Statut)
        linetoggle: {
            rules: {
                'tacheStatut': [
                    { value: 'completed', addClass: 'dim' }, // Griser si terminé
                    { value: 'error', addClass: 'error-row' }, // Fond rouge si erreur
                    { condition: 'notEquals', compareValue: 'completed', removeClass: 'dim'},
                    { condition: 'notEquals', compareValue: 'error', removeClass: 'error-row'}
                ]
            }
        },

        // Config Actions
        actions: {
            actions: {
                'save': {
                    handler: (ctx) => {
                        console.log('Sauvegarde Tâche:', ctx.data);
                        // Simuler sauvegarde
                        setTimeout(() => ctx.tableHandler.markRowAsSaved(ctx.row), 500);
                    },
                    showOnChange: true
                },
                'delete': {
                    handler: (ctx) => {
                        if(confirm(`Supprimer tâche "${ctx.data.tacheDesc}" ?`)) {
                            console.log('Suppression Tâche:', ctx.row.id);
                            ctx.tableHandler.removeRow(ctx.row);
                        }
                    },
                    confirm: false // Confirmation dans le handler
                }
            },
            icons: {
                 'save': '&lt;i class="fas fa-save" style="color: green; cursor: pointer;"&gt;&lt;/i&gt;',
                 'delete': '&lt;i class="fas fa-trash-alt" style="color: red; cursor: pointer;"&gt;&lt;/i&gt;'
            }
        },

        // Config ContextMenu (sera peuplé par TextEditor)
        contextmenu: {},

        // Config TextEditor (ajoute des options au menu contextuel)
        texteditor: {
             menuSection: 'Édition Description'
             // actions et shortcuts par défaut
        },

        // Config Sort (activé par th-sort sur Priorité)
        sort: {},

        // Config ColumnReorder (exclut ID et Actions par défaut via th-noreorder implicite si non présent)
        columnreorder: {
             excludeSelector: '[th-hide], [th-actions]' // Exclure ID et Actions
        },

        // Config Hide (activé par th-hide sur ID)
        hide: {}

        // Config FilterAndPaginate (si ajouté)
        /*
        filterandpaginate: {
            enableFilter: true,
            globalFilter: '#filterTaches',
            pageSize: 10,
            containerClass: 'pagination-container', // Assurez-vous que le style existe
            paginationClass: 'pagination',
            btnClass: 'btn btn-glass btn-glass-blue'
        }
        */
    }
});
</code></pre>
                        </div>
                    </div>
                </article>

                <article id="exemple-catalogue-produits">
                     <h3>Exemple 2 : Catalogue Produits Interactif</h3>
                     <p>Combine Color, Highlight, Sort, FilterAndPaginate, ColumnReorder, ContextMenu.</p>
                     <div class="example">
                         <div class="example-preview">
                              <input type="text" id="filterProduits" placeholder="Filtrer les produits...">

                              <table id="exempleTableProduits">
                                  <thead>
                                      <tr>
                                          <th id="prodSku" th-sort>SKU</th>
                                          <th id="prodNom" th-edit th-sort>Nom du Produit</th>
                                          <th id="prodCouleur" th-color>Couleur</th>
                                          <th id="prodStock" th-edit th-validate='{"number": {"min":0, "integer":true}}'>Stock</th>
                                          <th id="prodTags" th-edit>Tags (urgent, promo)</th>
                                      </tr>
                                  </thead>
                                   <tbody>
                                      <tr id="prod-101">
                                          <td id="prodSku_prod-101">ABC-001</td>
                                          <td id="prodNom_prod-101">Super Widget Bleu</td>
                                          <td id="prodCouleur_prod-101" data-value="#3b82f6">Bleu</td>
                                          <td id="prodStock_prod-101" data-value="50">50</td>
                                          <td id="prodTags_prod-101">nouveau, promo</td>
                                      </tr>
                                      <tr id="prod-102">
                                          <td id="prodSku_prod-102">XYZ-002</td>
                                          <td id="prodNom_prod-102">Widget Rouge Standard</td>
                                          <td id="prodCouleur_prod-102" data-value="#ef4444">Rouge</td>
                                          <td id="prodStock_prod-102" data-value="0">0</td>
                                          <td id="prodTags_prod-102">standard, urgent</td>
                                      </tr>
                                       <tr id="prod-103">
                                          <td id="prodSku_prod-103">DEF-003</td>
                                          <td id="prodNom_prod-103">Gadget Vert</td>
                                          <td id="prodCouleur_prod-103" data-value="#22c55e">Vert</td>
                                          <td id="prodStock_prod-103" data-value="120">120</td>
                                          <td id="prodTags_prod-103">best-seller</td>
                                      </tr>
                                      </tbody>
                              </table>
                         </div>
                         <div class="example-code">
                             <pre><code class="language-javascript">// Initialisation TableFlow pour l'exemple produits
import TableFlow from '../src/tableFlow.js'; // Ajustez

const produitsTable = new TableFlow({
    tableId: 'exempleTableProduits',
    pluginsPath: '../plugins', // Ajustez
    debug: true,
    plugins: {
        names: [
            'Edit', 'Validation', 'Color', 'Highlight', 'Sort',
            'FilterAndPaginate', 'ColumnReorder', 'ContextMenu'
        ],
        edit: {},
        validation: {}, // via th-validate
        color: {}, // via th-color
        highlight: { // Surligner 'urgent' et 'promo'
            groups: [
                { id: 'urgent', name: 'Urgent', color: 'red', backgroundColor: 'pink', priority: 0 },
                { id: 'promo', name: 'Promo', color: 'white', backgroundColor: 'green', priority: 1 }
            ],
            rules: [
                { group: 'urgent', regex: '\\burgent\\b' },
                { group: 'promo', regex: '\\bpromo\\b' }
            ],
            menuEnabled: true // Ajouter options au menu contextuel
        },
        sort: {}, // via th-sort
        filterandpaginate: {
            enableFilter: true,
            globalFilter: '#filterProduits',
            pageSize: 5 // Exemple
        },
        columnreorder: {}, // Toutes colonnes réorganisables par défaut
        contextmenu: {} // Sera peuplé par Highlight
    }
});</code></pre>
                         </div>
                     </div>
                </article>

            </section>

        </div>
    </div>

    <script type="module">
        // Script pour la navigation (identique à la version précédente)
        console.log("Documentation TableFlow chargée.");
        const updateNavActiveLink = () => {
            let currentSectionId = 'introduction';
            const sections = document.querySelectorAll('.content section[id], .content article[id]');
            const scrollPosition = window.scrollY || document.documentElement.scrollTop;
            const offset = 150; // Augmenter l'offset pour mieux détecter la section

            sections.forEach(section => {
                 if (section.offsetTop <= scrollPosition + offset) {
                    currentSectionId = section.id;
                 }
            });

            const currentHash = '#' + currentSectionId;
            document.querySelectorAll('.nav a.active').forEach(link => link.classList.remove('active'));

            const directLink = document.querySelector(`.nav a[href="${currentHash}"]`);
             if(directLink) {
                 directLink.classList.add('active');
                 const parentLi = directLink.closest('ul')?.closest('li');
                 // Activer le parent si c'est un sous-menu
                 if (parentLi && parentLi.parentElement.previousElementSibling?.tagName === 'LI') {
                      parentLi.parentElement.previousElementSibling.querySelector('a')?.classList.add('active');
                 }
             } else {
                 // Fallback si l'ID est dans un article (exemple)
                 const articleLink = document.querySelector(`.nav a[href="#exemples-complets"]`);
                 if (articleLink && currentSectionId.startsWith('exemple-')) {
                     articleLink.classList.add('active');
                     const subLink = document.querySelector(`.nav a[href="#${currentSectionId}"]`);
                     if (subLink) subLink.classList.add('active');
                 }
             }
        };
        window.addEventListener('load', updateNavActiveLink);
        window.addEventListener('scroll', updateNavActiveLink, { passive: true }); // Utiliser passive pour la performance
        window.addEventListener('hashchange', updateNavActiveLink);
        document.querySelectorAll('.nav a').forEach(link => {
            link.addEventListener('click', () => {
                setTimeout(() => { updateNavActiveLink(); }, 50);
            });
        });
    </script>
</body>
</html>