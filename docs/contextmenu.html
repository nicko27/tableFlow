<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation Plugin ContextMenu - TableFlow</title>
    <link rel="stylesheet" href="documentation.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Styles additionnels sp√©cifiques si n√©cessaire */
        body { padding: 2rem; }
        .content { margin-left: 0; } /* Pas de nav lat√©rale dans ce doc standalone */
         h1 { margin-bottom: 2rem; }
         tr.modified td { background-color: #fffbeb; } /* Style pour la coh√©rence */

         /* Styles par d√©faut du plugin (peuvent √™tre dans documentation.css ou surcharg√©s) */
         .tf-context-menu {
            position: absolute; /* Important */
            z-index: 1000;
            display: none; /* Cach√© par d√©faut */
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            padding: 5px 0;
            min-width: 180px;
         }
         .tf-menu-item {
            padding: 8px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            white-space: nowrap; /* Emp√™che le retour √† la ligne */
         }
         .tf-menu-item:hover {
            background: #f5f5f5;
         }
         .tf-menu-separator {
            height: 1px;
            background: #ddd;
            margin: 5px 0;
         }
         .tf-menu-header {
            padding: 5px 10px;
            font-weight: bold;
            color: #666;
            font-size: 0.9em;
         }
         .menu-icon { /* Classe ajout√©e par le plugin pour les ic√¥nes */
            margin-right: 8px;
            font-size: 1.1em;
            width: 20px;
            text-align: center;
            display: inline-block; /* Assure l'alignement */
         }
         .menu-label { /* Classe ajout√©e par le plugin pour le texte */
             flex-grow: 1; /* Prend l'espace restant */
         }
    </style>
</head>
<body>
    <div class="container">
        <div class="content">
            <h1>Documentation Plugin ContextMenu</h1>

            <section id="plugin-contextmenu-intro">
                <h2>Objectif</h2>
                <p>
                    Le plugin <strong>ContextMenu</strong> fournit un syst√®me centralis√© pour afficher un menu contextuel personnalis√© (menu clic droit) sur les cellules (`&lt;td&gt;`) d'un tableau TableFlow.
                </p>
                <p>
                    Il ne d√©finit pas lui-m√™me les options du menu. Au lieu de cela, il agit comme un **gestionnaire** qui interroge d'autres plugins actifs (les "fournisseurs" ou "providers") pour savoir quelles options de menu proposer pour la cellule sp√©cifique sur laquelle l'utilisateur a fait un clic droit.
                </p>
                <p>
                    Des plugins comme <a href="#plugin-texteditor">TextEditor</a> ou <a href="#plugin-selection">Selection</a> peuvent s'enregistrer aupr√®s de ContextMenu pour ajouter leurs propres actions au menu contextuel.
                </p>
            </section>

            <section id="plugin-contextmenu-activation">
                <h2>Activation et Configuration HTML</h2>
                <p>
                    Ce plugin ne n√©cessite <strong>aucun attribut HTML sp√©cifique</strong> pour son activation. Il est activ√© et configur√© uniquement via JavaScript.
                </p>
            </section>

            <section id="plugin-contextmenu-config-js">
                <h2>Configuration JavaScript</h2>
                <p>
                    La configuration du plugin se fait dans l'objet d'options de `TableFlow`, sous la cl√© <code class="value">plugins.contextmenu</code>.
                </p>
                <pre><code class="language-javascript">const tableInstance = new TableFlow({
    tableId: 'maTable',
    pluginsPath: '../plugins', // Ajustez
    plugins: {
        names: ['ContextMenu', /* ... autres plugins fournisseurs comme Edit, TextEditor, Selection ... */], // Activer le plugin
        contextmenu: { // Configuration sp√©cifique pour 'ContextMenu'
            menuClass: 'tf-context-menu', // Classe CSS pour le conteneur du menu (d√©faut)
            menuItemClass: 'tf-menu-item', // Classe CSS pour chaque option du menu (d√©faut)
            menuSeparatorClass: 'tf-menu-separator', // Classe CSS pour les s√©parateurs (d√©faut)
            menuHeaderClass: 'tf-menu-header', // Classe CSS pour les en-t√™tes de section (d√©faut)
            debug: false // Activer les logs sp√©cifiques
        }
        // ... configuration des autres plugins ...
    }
    // ... autres options TableFlow ...
});</code></pre>

                <h3>Tableau Complet des Options de Configuration JS (`plugins.contextmenu`)</h3>
                <div class="info-block">
                    Ce tableau liste toutes les options configurables pour le plugin ContextMenu via l'objet `plugins.contextmenu`. Ces options concernent principalement l'apparence du menu via les classes CSS.
                </div>
                <table class="documentation-table">
                    <thead>
                        <tr><th>Option (dans `plugins.contextmenu`)</th><th>Type</th><th>D√©faut</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code class="attr">menuClass</code></td><td class="type">string</td><td><code class="default">'tf-context-menu'</code></td><td>Classe CSS appliqu√©e √† l'√©l√©ment `&lt;div&gt;` principal du menu contextuel.</td></tr>
                        <tr><td><code class="attr">menuItemClass</code></td><td class="type">string</td><td><code class="default">'tf-menu-item'</code></td><td>Classe CSS appliqu√©e √† chaque `&lt;div&gt;` repr√©sentant une option cliquable dans le menu.</td></tr>
                        <tr><td><code class="attr">menuSeparatorClass</code></td><td class="type">string</td><td><code class="default">'tf-menu-separator'</code></td><td>Classe CSS appliqu√©e aux `&lt;div&gt;` utilis√©s comme s√©parateurs entre les groupes d'options (ajout√©s automatiquement entre les fournisseurs).</td></tr>
                        <tr><td><code class="attr">menuHeaderClass</code></td><td class="type">string</td><td><code class="default">'tf-menu-header'</code></td><td>Classe CSS appliqu√©e aux `&lt;div&gt;` utilis√©s comme en-t√™tes de section (si un fournisseur retourne un item de type `header`).</td></tr>
                        <tr><td><code class="attr">debug</code></td><td class="type">boolean</td><td><code class="default">false</code></td><td>Active les logs de d√©bogage sp√©cifiques au plugin ContextMenu. H√©rite de l'option `debug` globale de TableFlow si non sp√©cifi√©e ici.</td></tr>
                    </tbody>
                </table>
            </section>

            <section id="plugin-contextmenu-providers">
                <h2>Interface Fournisseur (Provider Interface)</h2>
                <p>
                    Pour qu'un autre plugin puisse ajouter des options au menu contextuel, il doit s'enregistrer aupr√®s du plugin ContextMenu et impl√©menter une interface sp√©cifique.
                </p>
                <ol>
                    <li>
                        <strong>Enregistrement :</strong> Dans la m√©thode `init()` du plugin fournisseur, apr√®s avoir obtenu une r√©f√©rence au plugin ContextMenu, il doit appeler :
                        <pre><code class="language-javascript">// Dans le plugin fournisseur (ex: TextEditor)
init(tableHandler) {
    this.table = tableHandler;
    this.contextMenuPlugin = this.table.getPlugin('ContextMenu');
    if (this.contextMenuPlugin) {
        this.contextMenuPlugin.registerProvider(this); // 'this' est l'instance du plugin fournisseur
    }
    // ...
}</code></pre>
                    </li>
                    <li>
                        <strong>M√©thode `getMenuItems(cell)` :</strong> Le plugin fournisseur DOIT impl√©menter cette m√©thode. Elle est appel√©e par ContextMenu lors d'un clic droit.
                        <ul>
                            <li>Elle re√ßoit en argument l'√©l√©ment `&lt;td&gt;` sur lequel le clic droit a eu lieu.</li>
                            <li>Elle DOIT retourner un <strong>tableau</strong> d'objets repr√©sentant les options de menu que ce fournisseur souhaite ajouter pour cette cellule sp√©cifique. Si aucune option n'est pertinente, elle retourne un tableau vide `[]`.</li>
                        </ul>
                    </li>
                    <li>
                        <strong>M√©thode `executeAction(actionId, cell)` :</strong> Le plugin fournisseur DOIT impl√©menter cette m√©thode. Elle est appel√©e par ContextMenu lorsque l'utilisateur clique sur une option de menu fournie par ce plugin.
                        <ul>
                            <li>Elle re√ßoit l'`id` de l'action (tel que d√©fini dans l'objet retourn√© par `getMenuItems`) et la cellule `&lt;td&gt;` qui √©tait cibl√©e lors de l'ouverture du menu.</li>
                            <li>Elle doit contenir la logique pour ex√©cuter l'action correspondante.</li>
                        </ul>
                    </li>
                </ol>

                <h3>Structure d'un Objet Menu Item (retourn√© par `getMenuItems`)</h3>
                <p>Chaque objet dans le tableau retourn√© par `getMenuItems` peut avoir les propri√©t√©s suivantes :</p>
                 <table class="documentation-table">
                     <thead>
                         <tr><th>Propri√©t√©</th><th>Type</th><th>Requis?</th><th>Description</th></tr>
                     </thead>
                     <tbody>
                         <tr><td><code class="attr">type</code></td><td class="type">string</td><td>Non</td><td>Peut √™tre `'separator'` pour ins√©rer un s√©parateur ou `'header'` pour un titre de section (utilise `label`). Si omis, c'est une option de menu standard.</td></tr>
                         <tr><td><code class="attr">id</code></td><td class="type">string</td><td>Oui (si standard)</td><td>Identifiant unique pour cette action au sein du fournisseur. Sera pass√© √† `executeAction`. Non requis pour `separator` ou `header`.</td></tr>
                         <tr><td><code class="attr">label</code></td><td class="type">string</td><td>Oui (si standard ou header)</td><td>Le texte affich√© pour l'option de menu ou l'en-t√™te de section.</td></tr>
                         <tr><td><code class="attr">icon</code></td><td class="type">string</td><td>Non</td><td>HTML (ou caract√®re) pour l'ic√¥ne √† afficher avant le label.</td></tr>
                         <tr><td><code class="attr">action</code></td><td class="type">function</td><td>Non</td><td>(Alternative) Une fonction `(cell) => void` √† ex√©cuter directement au clic. Si fournie, `executeAction` du fournisseur ne sera pas appel√©e pour cet item. Moins courant.</td></tr>
                         <tr><td><code class="attr">provider</code></td><td class="type">object</td><td>(Interne)</td><td>R√©f√©rence au plugin fournisseur, ajout√©e automatiquement par ContextMenu.</td></tr>
                     </tbody>
                 </table>
                 <pre><code class="language-javascript">// Exemple de retour de getMenuItems(cell) dans un plugin fournisseur
getMenuItems(cell) {
    const items = [];
    const isEditable = cell.classList.contains('td-edit'); // Exemple de condition

    if (isEditable) {
        items.push({ type: 'header', label: 'Mon Plugin' });
        items.push({ id: 'action1', label: 'Faire Action 1', icon: 'üöÄ' });
        items.push({ id: 'action2', label: 'Faire Action 2', icon: 'üí°' });
        items.push({ type: 'separator' });
        items.push({ id: 'action3', label: 'Autre Chose' });
    }
    return items;
}

// Exemple de executeAction(actionId, cell) dans le m√™me plugin
executeAction(actionId, cell) {
    if (actionId === 'action1') {
        // Logique pour action 1 sur 'cell'
        console.log('Action 1 sur', cell.id);
    } else if (actionId === 'action2') {
        // Logique pour action 2
        console.log('Action 2 sur', cell.id);
    } else if (actionId === 'action3') {
        // Logique pour action 3
        console.log('Action 3 sur', cell.id);
    }
}</code></pre>
            </section>

            <section id="plugin-contextmenu-how-it-works">
                <h2>Fonctionnement Interne</h2>
                <ul>
                    <li><strong>Initialisation (`init`, `createContextMenu`, `setupEventListeners`):</strong> Cr√©e l'√©l√©ment `div` du menu (cach√©) et l'ajoute au `body`. Ajoute un √©couteur `contextmenu` √† la table et des √©couteurs `click` et `keydown` au document pour fermer le menu.</li>
                    <li><strong>Enregistrement (`registerProvider`):</strong> Ajoute un plugin fournisseur √† sa liste interne `providers`.</li>
                    <li><strong>Gestion du Clic Droit (`handleContextMenu`):</strong>
                        <ul>
                            <li>Emp√™che le menu navigateur par d√©faut.</li>
                            <li>Identifie la cellule `<td>` cliqu√©e.</li>
                            <li>Appelle `collectMenuItems(cell)` pour r√©cup√©rer les options de tous les fournisseurs.</li>
                            <li>Si des options sont retourn√©es, appelle `showMenu(x, y, items)` pour construire et afficher le menu.</li>
                        </ul>
                    </li>
                    <li><strong>Collecte des Options (`collectMenuItems`):</strong> It√®re sur `this.providers`, appelle `provider.getMenuItems(cell)` pour chacun, ajoute un s√©parateur entre les groupes d'options de diff√©rents fournisseurs, et retourne la liste compl√®te.</li>
                    <li><strong>Affichage du Menu (`showMenu`):</strong>
                        <ul>
                            <li>Vide le contenu pr√©c√©dent du `div` de menu.</li>
                            <li>It√®re sur les `items` collect√©s :
                                <ul>
                                    <li>Cr√©e un `div` pour chaque item (option, s√©parateur, header) avec les classes CSS configur√©es.</li>
                                    <li>Ajoute le contenu (label, ic√¥ne).</li>
                                    <li>Pour les options cliquables, ajoute des √©couteurs `mouseover`/`mouseout` pour le style de survol et un √©couteur `click`.</li>
                                </ul>
                            </li>
                            <li>L'√©couteur `click` sur une option appelle `this.hideMenu()` puis la m√©thode `executeAction(itemId, currentCell)` du *fournisseur* associ√© √† l'item (ou la fonction `item.action` si elle existe).</li>
                            <li>Positionne le menu aux coordonn√©es du clic (`x`, `y`).</li>
                            <li>Ajuste la position si le menu d√©passe des bords de la fen√™tre.</li>
                            <li>Affiche le menu (`display: 'block'`).</li>
                        </ul>
                    </li>
                    <li><strong>Masquage du Menu (`hideMenu`):</strong> Cache le `div` du menu (`display: 'none'`) et r√©initialise `currentCell`.</li>
                </ul>
            </section>

             <section id="plugin-contextmenu-api">
                <h2>API Publique</h2>
                <p>
                    La principale m√©thode publique est destin√©e aux autres plugins pour s'enregistrer :
                </p>
                 <table class="documentation-table">
                     <thead>
                         <tr><th>M√©thode</th><th>Arguments</th><th>Description</th><th>Retour</th></tr>
                     </thead>
                     <tbody>
                         <tr><td><code>registerProvider(provider)</code></td><td><code class="attr">provider</code> <span class="type">(object)</span></td><td>Enregistre un autre plugin comme fournisseur d'options de menu. Le `provider` doit impl√©menter `getMenuItems(cell)` et `executeAction(actionId, cell)`.</td><td class="type">this (l'instance ContextMenu)</td></tr>
                     </tbody>
                 </table>
            </section>

            <section id="plugin-contextmenu-events">
                <h2>√âv√©nements</h2>
                <ul>
                    <li><strong>√âcout√©s :</strong>
                        <ul>
                            <li><code>contextmenu</code> (sur l'√©l√©ment `<table>`) : Pour d√©clencher l'affichage du menu.</li>
                            <li><code>click</code> (sur `document`) : Pour masquer le menu si un clic a lieu en dehors.</li>
                            <li><code>keydown</code> (sur `document`) : Pour masquer le menu si la touche √âchap est press√©e.</li>
                        </ul>
                    </li>
                    <li><strong>D√©clench√©s :</strong> Aucun √©v√©nement sp√©cifique d√©clench√© par ce plugin. Il facilite l'ex√©cution d'actions d√©finies par d'autres plugins.</li>
                </ul>
            </section>

            <section id="plugin-contextmenu-example">
                <h2>Exemple Complet</h2>
                <p>Cet exemple montre comment activer le plugin ContextMenu et comment un plugin simple (ici, un "LoggerPlugin" fictif) peut s'y enregistrer pour ajouter une option.</p>

                <strong>HTML (`index.html`):</strong>
                <pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Exemple ContextMenu Plugin&lt;/title&gt;
    <link rel="stylesheet" href="../src/tableFlow.css"> <link rel="stylesheet" href="documentation.css"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { padding: 2rem; }
        /* Styles menu contextuel */
        .tf-context-menu{position:absolute;z-index:1000;display:none;background:#fff;border:1px solid #ccc;border-radius:4px;box-shadow:0 2px 10px rgba(0,0,0,.2);padding:5px 0;min-width:180px}
        .tf-menu-item{padding:8px 15px;cursor:pointer;display:flex;align-items:center}
        .tf-menu-item:hover{background:#f5f5f5}
        .tf-menu-separator{height:1px;background:#ddd;margin:5px 0}
        .tf-menu-header{padding:5px 10px;font-weight:700;color:#666;font-size:.9em}
        .menu-icon{margin-right:8px;font-size:1.1em;width:20px;text-align:center}
    </style>
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;TableFlow - Exemple Plugin ContextMenu&lt;/h1&gt;
    &lt;p&gt;Faites un clic droit sur une cellule.&lt;/p&gt;

    &lt;table id="simpleTable"&gt;
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th id="colA"&gt;Colonne A&lt;/th&gt;
                &lt;th id="colB"&gt;Colonne B&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
            &lt;tr id="r1"&gt;
                &lt;td id="colA_r1"&gt;Valeur 1A&lt;/td&gt;
                &lt;td id="colB_r1"&gt;Valeur 1B&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr id="r2"&gt;
                &lt;td id="colA_r2"&gt;Valeur 2A&lt;/td&gt;
                &lt;td id="colB_r2"&gt;Valeur 2B&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/tbody&gt;
    &lt;/table&gt;

    &lt;script type="module"&gt;
        import TableFlow from '../src/tableFlow.js'; // Ajustez

        // --- D√©finition d'un plugin fournisseur Fictif ---
        class LoggerPlugin {
            constructor(config = {}) {
                this.name = 'Logger';
                this.table = null;
                this.contextMenuPlugin = null;
            }
            init(tableHandler) {
                this.table = tableHandler;
                this.contextMenuPlugin = this.table.getPlugin('ContextMenu');
                if (this.contextMenuPlugin) {
                    this.contextMenuPlugin.registerProvider(this);
                    console.log('LoggerPlugin enregistr√© aupr√®s de ContextMenu.');
                }
            }
            // M√©thode requise par ContextMenu
            getMenuItems(cell) {
                console.log('LoggerPlugin: getMenuItems appel√© pour', cell.id);
                return [
                    { type: 'header', label: 'Logs' },
                    { id: 'logCellId', label: 'Log ID Cellule', icon: 'üÜî' },
                    { id: 'logCellValue', label: 'Log Valeur Cellule', icon: 'üí¨' }
                ];
            }
            // M√©thode requise par ContextMenu
            executeAction(actionId, cell) {
                const value = cell.getAttribute('data-value') || cell.textContent.trim();
                if (actionId === 'logCellId') {
                    alert(`ID de la cellule : ${cell.id}`);
                    console.log(`ID de la cellule : ${cell.id}`);
                } else if (actionId === 'logCellValue') {
                    alert(`Valeur de la cellule ${cell.id} : ${value}`);
                    console.log(`Valeur de la cellule ${cell.id} : ${value}`);
                }
            }
            destroy() { /* Nettoyage si n√©cessaire */ }
        }
        // --- Fin du plugin fournisseur fictif ---


        // --- Initialisation de TableFlow ---
        const simpleTable = new TableFlow({
            tableId: 'simpleTable',
            pluginsPath: '../plugins', // Ajustez
            debug: true,
            plugins: {
                // Activer ContextMenu et notre LoggerPlugin
                // Note: LoggerPlugin n'est pas un fichier s√©par√© ici,
                // mais dans un vrai projet, il le serait et serait charg√© comme les autres.
                names: ['ContextMenu'], // 'Logger' serait ajout√© s'il √©tait un fichier s√©par√©
                contextmenu: {
                    // Config par d√©faut
                }
                // logger: {} // Config pour Logger si n√©cessaire
            }
        });

        // Enregistrer manuellement notre LoggerPlugin apr√®s l'initialisation de TableFlow
        // (Car il n'est pas charg√© comme les autres plugins dans cet exemple)
        const loggerInstance = new LoggerPlugin();
        loggerInstance.init(simpleTable); // L'init enregistre le provider

    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

                <strong>Fonctionnement de l'exemple :</strong>
                <ol>
                    <li>La table s'affiche normalement.</li>
                    <li>Le plugin `ContextMenu` est activ√©.</li>
                    <li>Un plugin fictif `LoggerPlugin` est d√©fini et instanci√©. Sa m√©thode `init` l'enregistre aupr√®s de `ContextMenu`.</li>
                    <li>Lorsque vous faites un clic droit sur une cellule (ex: "Valeur 1A") :
                        <ul>
                            <li>Le plugin `ContextMenu` intercepte l'√©v√©nement.</li>
                            <li>Il appelle `getMenuItems()` sur `LoggerPlugin`.</li>
                            <li>`LoggerPlugin` retourne les options "Log ID Cellule" et "Log Valeur Cellule".</li>
                            <li>`ContextMenu` affiche le menu avec ces options sous l'en-t√™te "Logs".</li>
                        </ul>
                    </li>
                    <li>Si vous cliquez sur "Log ID Cellule", `ContextMenu` appelle `LoggerPlugin.executeAction('logCellId', cell)`.</li>
                    <li>`LoggerPlugin` affiche alors une alerte avec l'ID de la cellule (ex: "colA_r1").</li>
                </ol>
            </section>

        </div>
    </div>
</body>
</html>