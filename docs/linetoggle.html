<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation Plugin LineToggle - TableFlow</title>
    <link rel="stylesheet" href="documentation.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Styles additionnels spécifiques si nécessaire */
        body { padding: 2rem; }
        .content { margin-left: 0; } /* Pas de nav latérale dans ce doc standalone */
         h1 { margin-bottom: 2rem; }
         tr.modified td { background-color: #fffbeb; } /* Style pour la cohérence */

         /* Exemples de classes pour LineToggle */
         tr.highlight { background-color: #d1fae5 !important; /* Vert pâle */ }
         tr.dim { opacity: 0.6; }
         tr.error-row { background-color: #fee2e2 !important; /* Rouge pâle */ }
         tr.warning-row { border-left: 5px solid #facc15; /* Jaune */ }
    </style>
</head>
<body>
    <div class="container">
        <div class="content">
            <h1>Documentation Plugin LineToggle</h1>

            <section id="plugin-linetoggle-intro">
                <h2>Objectif</h2>
                <p>
                    Le plugin <strong>LineToggle</strong> permet de modifier dynamiquement les classes CSS d'une ligne entière (`&lt;tr&gt;`) en fonction de la valeur d'une cellule spécifique dans cette ligne.
                </p>
                <p>
                    Cela permet de mettre en évidence visuellement des lignes basées sur des conditions définies (par exemple, changer la couleur de fond si un statut est "Terminé", ajouter une bordure si une priorité est "Haute", etc.). Les règles de modification de classe peuvent être définies directement dans l'attribut HTML ou via la configuration JavaScript.
                </p>
            </section>

            <section id="plugin-linetoggle-activation">
                <h2>Activation et Configuration HTML</h2>
                <p>
                    Pour activer le plugin LineToggle sur une colonne, ajoutez l'attribut <code class="attr">th-linetoggle</code> à l'élément <code>&lt;th&gt;</code> correspondant.
                </p>
                <p>
                    Vous pouvez définir des règles simples directement dans cet attribut en utilisant une chaîne JSON valide. Si l'attribut est présent mais vide (<code class="attr">th-linetoggle</code>) ou égal à `true`, les règles doivent être définies dans la configuration JavaScript.
                </p>
                <pre><code class="language-html">&lt;table id="maTable"&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th id="colDescription"&gt;Description&lt;/th&gt;
      &lt;!-- Activer via JS --&gt;
      &lt;th id="colStatut" th-linetoggle&gt;Statut (Règles via JS)&lt;/th&gt;
      &lt;!-- Activer et définir des règles simples via HTML --&gt;
      &lt;th id="colPriorite"
          th-linetoggle='[
              {"value": "Haute", "addClass": "highlight"},
              {"value": "Basse", "addClass": "dim"}
          ]'&gt;Priorité (Règles via HTML)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;!-- Lignes de données --&gt;
    &lt;tr id="row1"&gt;
        &lt;td id="colDescription_row1"&gt;Tâche 1&lt;/td&gt;
        &lt;td id="colStatut_row1" data-value="pending"&gt;En attente&lt;/td&gt;
        &lt;td id="colPriorite_row1" data-value="Haute"&gt;Haute&lt;/td&gt; &lt;!-- Aura la classe 'highlight' --&gt;
    &lt;/tr&gt;
     &lt;tr id="row2"&gt;
        &lt;td id="colDescription_row2"&gt;Tâche 2&lt;/td&gt;
        &lt;td id="colStatut_row2" data-value="completed"&gt;Terminé&lt;/td&gt; &lt;!-- Style défini par JS --&gt;
        &lt;td id="colPriorite_row2" data-value="Basse"&gt;Basse&lt;/td&gt; &lt;!-- Aura la classe 'dim' --&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;</code></pre>
                <p>
                    Les règles définies dans l'attribut HTML sont fusionnées avec celles définies dans la configuration JavaScript pour la même colonne.
                </p>
            </section>

            <section id="plugin-linetoggle-config-js">
                <h2>Configuration JavaScript</h2>
                <p>
                    La configuration détaillée du plugin se fait dans l'objet d'options de `TableFlow`, sous la clé <code class="value">plugins.linetoggle</code>.
                </p>
                <pre><code class="language-javascript">const tableInstance = new TableFlow({
    tableId: 'maTable',
    pluginsPath: '../plugins', // Ajustez
    plugins: {
        names: ['LineToggle', /* ... autres plugins ... */], // Activer le plugin
        linetoggle: { // Configuration spécifique pour 'LineToggle'
            // --- Options Générales du Plugin ---
            lineToggleAttribute: 'th-linetoggle', // Attribut HTML pour activer/configurer (défaut)
            applyOnInit: true, // Appliquer les règles au chargement initial (défaut: true)
            applyOnChange: true, // Appliquer les règles lors d'un 'cell:change' (défaut: true)
            debug: false, // Activer les logs spécifiques

            // --- Règles de Modification de Classe ---
            rules: {
                // Clé = ID du <th> de la colonne à surveiller
                'colStatut': [ // Règles pour la colonne avec th id="colStatut"
                    {
                        // Condition: la valeur de la cellule est exactement 'completed'
                        value: 'completed',
                        // Actions: ajouter la classe 'highlight', retirer la classe 'dim'
                        addClass: 'highlight',
                        removeClass: 'dim'
                    },
                    {
                        // Condition: la valeur est 'pending' OU 'in_progress'
                        values: ['pending', 'in_progress'],
                        // Action: retirer la classe 'highlight'
                        removeClass: 'highlight'
                    },
                    {
                        // Condition: la valeur commence par 'error' (insensible à la casse via regex)
                        regex: '^error', // Le plugin utilise new RegExp(), donc pas besoin de /.../i
                        // Action: ajouter la classe 'error-row'
                        addClass: 'error-row'
                    }
                ],
                'colPriorite': [ // Règles additionnelles pour la colonne 'colPriorite'
                    // Ces règles seront fusionnées avec celles définies dans l'attribut th-linetoggle
                    {
                        // Condition: la valeur est 'Moyenne'
                        condition: 'equals',
                        compareValue: 'Moyenne',
                        // Action: retirer les classes 'highlight' et 'dim'
                        removeClass: ['highlight', 'dim']
                    },
                    {
                        // Condition: la valeur de la cellule est vide
                        condition: 'empty',
                        // Action: ajouter la classe 'warning-row'
                        addClass: 'warning-row'
                    }
                    // Note: les règles HTML pour 'Haute' et 'Basse' s'appliquent aussi
                ]
                // ... règles pour d'autres colonnes 'th-linetoggle'
            }
        }
    }
    // ... autres options TableFlow ...
});</code></pre>

                <h3>Tableau Complet des Options de Configuration JS (`plugins.linetoggle`)</h3>
                <div class="info-block">
                    Ce tableau liste toutes les options configurables pour le plugin LineToggle via l'objet `plugins.linetoggle`.
                </div>
                <table class="documentation-table">
                    <thead>
                        <tr><th>Option (dans `plugins.linetoggle`)</th><th>Type</th><th>Défaut</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code class="attr">lineToggleAttribute</code></td><td class="type">string</td><td><code class="default">'th-linetoggle'</code></td><td>Nom de l'attribut HTML sur `<th>` pour activer le plugin et potentiellement définir des règles JSON.</td></tr>
                        <tr><td><code class="attr">applyOnInit</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Si `true`, les règles sont appliquées à toutes les lignes lors de l'initialisation de TableFlow.</td></tr>
                        <tr><td><code class="attr">applyOnChange</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Si `true`, les règles sont ré-appliquées à une ligne lorsque la valeur d'une cellule dans une colonne surveillée change (événement `cell:change`).</td></tr>
                        <tr><td><code class="attr">debug</code></td><td class="type">boolean</td><td><code class="default">false</code></td><td>Active les logs de débogage spécifiques au plugin LineToggle. Hérite de l'option `debug` globale de TableFlow si non spécifiée ici.</td></tr>
                        <tr><td><code class="attr">rules</code></td><td class="type">object</td><td><code class="default">{}</code></td><td><strong>(Essentiel si non défini en HTML)</strong> Objet contenant les règles de modification de classe pour chaque colonne surveillée. La clé est l'ID du `<th>`, la valeur est un tableau d'objets "règle" (voir tableau suivant).</td></tr>
                    </tbody>
                </table>

                <h3>Structure Complète d'un Objet Règle (dans `plugins.linetoggle.rules[columnId]`)</h3>
                 <div class="info-block">
                    Chaque élément du tableau de règles pour une colonne définit une condition et les actions (ajout/suppression de classes) à effectuer sur la ligne (`<tr>`) si la condition est remplie par la valeur de la cellule (`<td>`) dans cette colonne. Plusieurs règles peuvent s'appliquer à la même cellule/ligne.
                 </div>
                <table class="documentation-table">
                     <thead>
                         <tr><th>Propriété (dans l'objet règle)</th><th>Type</th><th>Description</th></tr>
                     </thead>
                     <tbody>
                         <tr><td><code class="attr">value</code></td><td><code class="type">string | number | boolean</code></td><td>La règle s'applique si la valeur de la cellule est <strong>strictement égale</strong> (après conversion en chaîne) à cette valeur.</td></tr>
                         <tr><td><code class="attr">values</code></td><td><code class="type">Array</code></td><td>La règle s'applique si la valeur de la cellule (convertie en chaîne) est présente dans ce tableau de valeurs.</td></tr>
                         <tr><td><code class="attr">regex</code></td><td><code class="type">string</code></td><td>La règle s'applique si la valeur de la cellule correspond à cette <strong>expression régulière</strong> (fournie comme chaîne, ex: `"^start"`, `"[0-9]+$"`).</td></tr>
                         <tr><td><code class="attr">condition</code></td><td><code class="type">string</code></td><td>Utilise une condition prédéfinie pour comparer la valeur de la cellule avec `compareValue`. Valeurs possibles : `'equals'`, `'notEquals'`, `'contains'`, `'startsWith'`, `'endsWith'`, `'greater'`, `'less'`, `'greaterOrEqual'`, `'lessOrEqual'`, `'empty'`, `'notEmpty'`.</td></tr>
                         <tr><td><code class="attr">compareValue</code></td><td><code class="type">any</code></td><td>La valeur à utiliser pour la comparaison lorsque `condition` est définie (sauf pour 'empty'/'notEmpty').</td></tr>
                         <tr><td><code class="attr">test</code></td><td><code class="type">function</code></td><td>Une fonction personnalisée `(cellValue) => boolean`. La règle s'applique si la fonction retourne `true`. Permet des logiques de condition complexes.</td></tr>
                         <tr><td><code class="attr">addClass</code></td><td><code class="type">string | Array&lt;string&gt;</code></td><td><strong>(Action)</strong> Une ou plusieurs classes CSS à ajouter à l'élément `<tr>` si la condition est remplie.</td></tr>
                         <tr><td><code class="attr">removeClass</code></td><td><code class="type">string | Array&lt;string&gt;</code></td><td><strong>(Action)</strong> Une ou plusieurs classes CSS à retirer de l'élément `<tr>` si la condition est remplie.</td></tr>
                     </tbody>
                 </table>
                 <div class="warning-block">
                     <strong>Priorité des Conditions :</strong> Le code vérifie les conditions dans un ordre spécifique (value, values, regex, test, condition). La première condition valide dans une règle déclenche les actions `addClass`/`removeClass`. Assurez-vous qu'une règle ne contient qu'un seul type de condition pour éviter les ambiguïtés.
                 </div>
            </section>

            <section id="plugin-linetoggle-how-it-works">
                <h2>Fonctionnement Interne</h2>
                <ul>
                    <li><strong>Initialisation (`init`, `setupLineToggleColumns`):</strong>
                        <ul>
                            <li>Identifie les `<th>` avec l'attribut `lineToggleAttribute`.</li>
                            <li>Pour chaque colonne trouvée :
                                <ul>
                                    <li>Récupère les règles définies dans l'attribut HTML (si JSON valide).</li>
                                    <li>Récupère les règles définies dans la configuration JS (`config.rules[columnId]`).</li>
                                    <li>Fusionne les deux listes de règles.</li>
                                    <li>Si `applyOnInit` est `true`, appelle `applyRulesToColumn` pour traiter toutes les lignes existantes pour cette colonne.</li>
                                </ul>
                            </li>
                            <li>Ajoute des écouteurs pour `cell:change` et `row:added`.</li>
                        </ul>
                    </li>
                    <li><strong>Application des Règles à une Colonne (`applyRulesToColumn`):</strong> Itère sur toutes les lignes du tableau et appelle `applyRulesToRow` pour chaque ligne, en passant les règles de la colonne.</li>
                    <li><strong>Application des Règles à une Ligne (`applyRulesToRow`):</strong>
                        <ul>
                            <li>Récupère la cellule correspondante dans la ligne (`row.cells[columnIndex]`).</li>
                            <li>Obtient la valeur de la cellule (priorité à `data-value`, sinon `textContent`).</li>
                            <li>Itère sur chaque règle définie pour la colonne.</li>
                            <li>Pour chaque règle, vérifie si elle s'applique à la valeur de la cellule en utilisant `ruleApplies()`.</li>
                            <li>Si `ruleApplies()` retourne `true`, exécute les actions `addClass` et `removeClass` sur l'élément `<tr>` de la ligne.</li>
                        </ul>
                    </li>
                    <li><strong>Vérification d'une Règle (`ruleApplies`):</strong> Teste la condition de la règle (value, values, regex, test, condition) par rapport à la valeur de la cellule et retourne `true` ou `false`.</li>
                    <li><strong>Gestion des Changements (`handleCellChange`):</strong>
                        <ul>
                            <li>Si `applyOnChange` est `true`.</li>
                            <li>Identifie la cellule et la colonne modifiées à partir de l'événement.</li>
                            <li>Vérifie si la colonne modifiée est surveillée par LineToggle.</li>
                            <li>Si oui, récupère les règles pour cette colonne et appelle `applyRulesToRow` pour la ligne concernée.</li>
                        </ul>
                    </li>
                    <li><strong>Gestion des Nouvelles Lignes (`handleRowAdded`):</strong>
                        <ul>
                             <li>Si `applyOnInit` est `true`.</li>
                             <li>Pour chaque colonne surveillée par LineToggle, appelle `applyRulesToRow` pour la nouvelle ligne ajoutée.</li>
                        </ul>
                    </li>
                     <li><strong>Rafraîchissement (`refresh`):</strong> Si `applyOnInit` est `true`, ré-exécute `setupLineToggleColumns()` pour ré-appliquer toutes les règles à toutes les lignes.</li>
                </ul>
            </section>

            <section id="plugin-linetoggle-events">
                <h2>Événements</h2>
                <ul>
                    <li><strong>Écoutés :</strong>
                        <ul>
                            <li><code>cell:change</code> : Pour ré-évaluer les règles sur une ligne lorsque la valeur d'une cellule surveillée change (si `applyOnChange` est `true`).</li>
                            <li><code>row:added</code> : Pour appliquer les règles aux nouvelles lignes ajoutées (si `applyOnInit` est `true`).</li>
                        </ul>
                    </li>
                    <li><strong>Déclenchés :</strong> Aucun événement spécifique déclenché par ce plugin. Il modifie directement les classes des `<tr>`.</li>
                </ul>
            </section>

            <section id="plugin-linetoggle-example">
                <h2>Exemple Complet</h2>
                <p>Cet exemple applique différents styles aux lignes en fonction du statut et de la priorité.</p>

                <strong>HTML (`index.html`):</strong>
                <pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Exemple LineToggle Plugin&lt;/title&gt;
    <link rel="stylesheet" href="../src/tableFlow.css"> <link rel="stylesheet" href="documentation.css"> <style>
        body { padding: 2rem; }
        tr.modified td { background-color: #fffbeb; }
        /* Styles pour les classes ajoutées par LineToggle */
        tr.status-termine td { background-color: #f0fdf4; text-decoration: line-through; color: #6b7280; }
        tr.status-erreur td { background-color: #fef2f2; font-weight: bold; color: #b91c1c; }
        tr.priorite-haute { border-left: 4px solid #dc2626; } /* Rouge */
        tr.priorite-basse { opacity: 0.7; }
    </style>
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;TableFlow - Exemple Plugin LineToggle&lt;/h1&gt;

    &lt;table id="taskTable"&gt;
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th id="taskDesc"&gt;Tâche&lt;/th&gt;
                &lt;th id="taskStatus" th-linetoggle&gt;Statut&lt;/th&gt;
                &lt;th id="taskPriority"
                    th-linetoggle='[{"value": "Haute", "addClass": "priorite-haute"}]'&gt;
                    Priorité
                &lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
            &lt;tr id="t1"&gt;
                &lt;td id="taskDesc_t1"&gt;Corriger bug critique&lt;/td&gt;
                &lt;td id="taskStatus_t1" data-value="En cours"&gt;En cours&lt;/td&gt;
                &lt;td id="taskPriority_t1" data-value="Haute"&gt;Haute&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr id="t2"&gt;
                &lt;td id="taskDesc_t2"&gt;Mettre à jour la documentation&lt;/td&gt;
                &lt;td id="taskStatus_t2" data-value="Terminé"&gt;Terminé&lt;/td&gt;
                &lt;td id="taskPriority_t2" data-value="Basse"&gt;Basse&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr id="t3"&gt;
                &lt;td id="taskDesc_t3"&gt;Déployer en production&lt;/td&gt;
                &lt;td id="taskStatus_t3" data-value="Erreur"&gt;Erreur&lt;/td&gt;
                &lt;td id="taskPriority_t3" data-value="Haute"&gt;Haute&lt;/td&gt;
            &lt;/tr&gt;
             &lt;tr id="t4"&gt;
                &lt;td id="taskDesc_t4"&gt;Planifier réunion&lt;/td&gt;
                &lt;td id="taskStatus_t4" data-value="En attente"&gt;En attente&lt;/td&gt;
                &lt;td id="taskPriority_t4" data-value="Moyenne"&gt;Moyenne&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/tbody&gt;
    &lt;/table&gt;

    &lt;!-- Pour tester applyOnChange, on ajoute le plugin Choice --&gt;
    &lt;script type="module"&gt;
        import TableFlow from '../src/tableFlow.js'; // Ajustez

        const taskTable = new TableFlow({
            tableId: 'taskTable',
            pluginsPath: '../plugins', // Ajustez
            debug: true,
            plugins: {
                names: ['LineToggle', 'Choice'], // Activer LineToggle et Choice
                linetoggle: {
                    rules: {
                        'taskStatus': [ // Règles pour la colonne Statut
                            { value: 'Terminé', addClass: 'status-termine' },
                            { value: 'Erreur', addClass: 'status-erreur' },
                            // Retirer les classes si ce n'est ni Terminé ni Erreur
                            { condition: 'notEquals', compareValue: 'Terminé', removeClass: 'status-termine' },
                            { condition: 'notEquals', compareValue: 'Erreur', removeClass: 'status-erreur' }
                        ],
                        'taskPriority': [ // Règle additionnelle pour Priorité (fusionnée avec celle de l'HTML)
                            { value: 'Basse', addClass: 'priorite-basse' },
                            // Retirer les classes si ni Haute ni Basse
                            { condition: 'notEquals', compareValue: 'Haute', removeClass: 'priorite-haute' },
                            { condition: 'notEquals', compareValue: 'Basse', removeClass: 'priorite-basse' }
                        ]
                    }
                    // applyOnInit et applyOnChange sont true par défaut
                },
                choice: { // Configurer Choice pour pouvoir changer les valeurs
                    columns: {
                        'taskStatus': {
                            type: 'toggle',
                            values: ['En attente', 'En cours', 'Terminé', 'Erreur']
                        },
                        'taskPriority': {
                            type: 'toggle',
                            values: ['Basse', 'Moyenne', 'Haute']
                        }
                    }
                }
            }
        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

                <strong>Fonctionnement de l'exemple :</strong>
                <ol>
                    <li>Au chargement (`applyOnInit: true`) :
                        <ul>
                            <li>La ligne t1 (Priorité Haute) obtient la classe `priorite-haute` (bordure rouge).</li>
                            <li>La ligne t2 (Statut Terminé, Priorité Basse) obtient les classes `status-termine` (barré, fond vert pâle) et `priorite-basse` (opacité réduite).</li>
                            <li>La ligne t3 (Statut Erreur, Priorité Haute) obtient les classes `status-erreur` (fond rouge pâle, gras) et `priorite-haute`.</li>
                            <li>La ligne t4 n'obtient aucune classe spéciale initialement.</li>
                        </ul>
                    </li>
                    <li>Le plugin Choice est activé sur les colonnes Statut et Priorité.</li>
                    <li>Si vous cliquez sur le statut de la ligne t1 ("En cours") et le changez en "Terminé" :
                        <ul>
                            <li>L'événement `cell:change` est déclenché par Choice.</li>
                            <li>LineToggle écoute cet événement (`applyOnChange: true`).</li>
                            <li>Il applique les règles pour `taskStatus`: la classe `status-termine` est ajoutée.</li>
                            <li>La ligne t1 aura maintenant le style barré/fond vert pâle ET la bordure rouge.</li>
                        </ul>
                    </li>
                    <li>Si vous changez ensuite le statut de t1 en "En attente" :
                        <ul>
                           <li>LineToggle applique les règles : `status-termine` est retirée.</li>
                           <li>La ligne t1 n'a plus que la bordure rouge.</li>
                        </ul>
                    </li>
                     <li>De même, changer la priorité modifiera les classes `priorite-haute` ou `priorite-basse`.</li>
                </ol>
            </section>

        </div>
    </div>
</body>
</html>