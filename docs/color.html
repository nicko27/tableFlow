<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation Plugin Color - TableFlow</title>
    <link rel="stylesheet" href="documentation.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Styles additionnels spécifiques si nécessaire */
        body { padding: 2rem; }
        .content { margin-left: 0; } /* Pas de nav latérale dans ce doc standalone */
         h1 { margin-bottom: 2rem; }
         /* Style pour les cellules readonly (exemple) */
         .readonly-color {
             cursor: not-allowed !important;
             opacity: 0.6;
         }
         /* Style par défaut du plugin (peut être surchargé par documentation.css) */
         .tf-color-wrapper {
            display: flex;
            align-items: center;
            justify-content: flex-start; /* Aligner à gauche par défaut */
            gap: 5px; /* Espace entre preview et input */
            padding: 0; /* Le padding est sur le TD */
         }
         .tf-color-wrapper .color-preview { /* Style pour l'aperçu ajouté par ColorFlow */
            width: 20px;
            height: 20px;
            border: 1px solid #e5e7eb; /* var(--border-color) */
            border-radius: 4px;
            cursor: pointer;
         }
         .tf-color-wrapper .color-input {
            width: 80px;
            text-align: center;
            border: 1px solid #e5e7eb; /* var(--border-color) */
            border-radius: 4px;
            padding: 3px 5px;
            font-size: inherit; /* Hériter la taille de police */
         }
         tr.modified td { background-color: #fffbeb; }
    </style>
</head>
<body>
    <div class="container">
        <div class="content">
            <h1>Documentation Plugin Color</h1>

            <section id="plugin-color-intro">
                <h2>Objectif</h2>
                <p>
                    Le plugin <strong>Color</strong> permet aux utilisateurs de sélectionner une couleur pour une cellule à l'aide d'un sélecteur de couleur visuel. Il transforme le contenu textuel initial de la cellule (qui peut être un nom de couleur CSS, un code hexadécimal, RGB, etc.) en une représentation visuelle (un carré de couleur) et un champ de saisie affichant le code hexadécimal.
                </p>
                <p>
                    Ce plugin repose sur une bibliothèque externe (implicitement `ColorFlow` d'après le code) qui doit être incluse dans votre page pour que le sélecteur de couleur fonctionne correctement.
                </p>
                <p>
                    Il met à jour la valeur `data-value` de la cellule avec le code hexadécimal de la couleur sélectionnée et marque la ligne comme modifiée.
                </p>
                 <div class="warning-block">
                    <strong>Dépendance Externe :</strong> Ce plugin nécessite une bibliothèque externe (probablement `ColorFlow`) pour fonctionner. Assurez-vous d'inclure le script de cette bibliothèque dans votre page HTML avant d'initialiser TableFlow avec le plugin Color.
                 </div>
            </section>

            <section id="plugin-color-activation">
                <h2>Activation et Configuration HTML</h2>
                <p>
                    Pour activer le plugin Color sur une colonne, ajoutez l'attribut <code class="attr">th-color</code> à l'élément <code>&lt;th&gt;</code> correspondant. Aucune valeur n'est nécessaire pour cet attribut.
                </p>
                <pre><code class="language-html">&lt;table id="maTable"&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th id="colItem"&gt;Article&lt;/th&gt;
      &lt;th id="colCouleur" th-color&gt;Couleur&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;!-- Lignes de données --&gt;
    &lt;tr id="row1"&gt;
        &lt;td id="colItem_row1"&gt;T-shirt&lt;/td&gt;
        &lt;!-- La valeur initiale peut être n'importe quel format de couleur CSS valide --&gt;
        &lt;td id="colCouleur_row1" data-value="#FF0000"&gt;Rouge&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr id="row2"&gt;
        &lt;td id="colItem_row2"&gt;Pantalon&lt;/td&gt;
        &lt;td id="colCouleur_row2" data-value="#0000FF"&gt;blue&lt;/td&gt; &lt;!-- Le plugin convertira en HEX --&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;</code></pre>
                <p>
                    Le plugin lira le contenu textuel initial ou l'attribut `data-value` de la cellule `<td>`, tentera de le convertir en code hexadécimal, et l'utilisera comme valeur initiale. Il est recommandé de fournir la valeur initiale via `data-value` en format hexadécimal pour plus de fiabilité.
                </p>
            </section>

            <section id="plugin-color-config-js">
                <h2>Configuration JavaScript</h2>
                <p>
                    La configuration du plugin se fait dans l'objet d'options de `TableFlow`, sous la clé <code class="value">plugins.color</code>.
                </p>
                <pre><code class="language-javascript">const tableInstance = new TableFlow({
    tableId: 'maTable',
    pluginsPath: '../plugins', // Ajustez
    plugins: {
        names: ['Color', /* ... autres plugins ... */], // Activer le plugin
        color: { // Configuration spécifique pour 'Color'
            // --- Options Générales du Plugin ---
            colorAttribute: 'th-color', // Attribut HTML pour activer (défaut)
            cellClass: 'td-color', // Classe CSS pour les cellules gérées (défaut)
            readOnlyClass: 'readonly-color', // Classe CSS pour les cellules non modifiables (défaut: 'readonly')
            modifiedClass: 'modified', // Classe CSS pour les lignes modifiées (défaut)
            debug: false, // Activer les logs spécifiques
            customClass: '' // Classe CSS additionnelle à ajouter au conteneur du picker ColorFlow
        }
    }
    // ... autres options TableFlow ...
});

// Assurez-vous que ColorFlow est chargé et disponible
// Exemple d'instanciation si ColorFlow est une classe globale
// const colorFlowInstance = new ColorFlow({ customClass: 'mon-picker' });
// Le plugin Color utilisera l'instance globale ou en créera une si nécessaire (basé sur le code actuel)
</code></pre>

                <h3>Tableau Complet des Options de Configuration JS (`plugins.color`)</h3>
                <div class="info-block">
                    Ce tableau liste toutes les options configurables pour le plugin Color via l'objet `plugins.color`.
                </div>
                <table class="documentation-table">
                    <thead>
                        <tr><th>Option (dans `plugins.color`)</th><th>Type</th><th>Défaut</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code class="attr">colorAttribute</code></td><td class="type">string</td><td><code class="default">'th-color'</code></td><td>Nom de l'attribut HTML sur `<th>` pour activer le plugin sur une colonne.</td></tr>
                        <tr><td><code class="attr">cellClass</code></td><td class="type">string</td><td><code class="default">'td-color'</code></td><td>Classe CSS ajoutée aux `<td>` gérées par ce plugin.</td></tr>
                        <tr><td><code class="attr">readOnlyClass</code></td><td class="type">string</td><td><code class="default">'readonly'</code></td><td>Classe CSS ajoutée aux `<td>` si elles doivent être considérées comme non modifiables (logique à implémenter séparément, le plugin ne gère pas nativement le readonly).</td></tr>
                        <tr><td><code class="attr">modifiedClass</code></td><td class="type">string</td><td><code class="default">'modified'</code></td><td>Classe CSS utilisée pour marquer les lignes (`<tr>`) modifiées lorsque la couleur change.</td></tr>
                        <tr><td><code class="attr">debug</code></td><td class="type">boolean</td><td><code class="default">false</code></td><td>Active les logs de débogage spécifiques au plugin Color. Hérite de l'option `debug` globale de TableFlow si non spécifiée ici.</td></tr>
                        <tr><td><code class="attr">customClass</code></td><td class="type">string</td><td><code class="default">''</code></td><td>Classe CSS personnalisée qui sera ajoutée à l'élément conteneur du sélecteur de couleur généré par la bibliothèque externe (ColorFlow).</td></tr>
                    </tbody>
                </table>
            </section>

            <section id="plugin-color-how-it-works">
                <h2>Fonctionnement Interne</h2>
                <ul>
                    <li><strong>Initialisation (`init`, `setupColorCells`, `setupColorCell`):</strong> Identifie les colonnes `th-color`. Pour chaque cellule `<td>` correspondante :
                        <ul>
                            <li>Ajoute la classe `cellClass`.</li>
                            <li>Lit la valeur initiale (`data-value` ou texte) et la convertit en hexadécimal via `toHexColor()`.</li>
                            <li>Stocke la valeur hexadécimale dans `data-value` et `data-initial-value`.</li>
                            <li>Crée un wrapper `div.tf-color-wrapper`.</li>
                            <li>Crée un input texte (`input.color-input`) avec la valeur hexadécimale et l'attribut `cf-format="hex"`.</li>
                            <li>Vide la cellule et y ajoute le wrapper contenant l'input.</li>
                            <li>Utilise `setTimeout` pour s'assurer que le DOM est prêt, puis instancie `ColorFlow` (si pas déjà fait) et appelle `this.colorHandler.setupInput(input)` pour attacher le picker de couleur à l'input. La bibliothèque ColorFlow ajoute généralement un aperçu (`.color-preview`) à côté de l'input.</li>
                            <li>Ajoute des écouteurs (`input`, `change`) à l'input pour détecter les changements de couleur (via le picker ou saisie directe).</li>
                        </ul>
                    </li>
                    <li><strong>Sélection de Couleur (via ColorFlow et écouteurs) :</strong>
                        <ul>
                            <li>Lorsque la couleur est modifiée, la fonction `updateValue` est appelée.</li>
                            <li>Elle compare la nouvelle valeur (toujours en hexadécimal) avec l'ancienne (`data-value`).</li>
                            <li>Si la valeur a changé :
                                <ul>
                                    <li>Met à jour `data-value`.</li>
                                    <li>Met à jour la couleur de fond de l'aperçu (`.color-preview`).</li>
                                    <li>Marque la ligne comme modifiée (`modifiedClass`) si la nouvelle valeur diffère de `data-initial-value`.</li>
                                    <li>Déclenche l'événement `cell:change` avec les détails (IDs, ancienne/nouvelle valeur hex, cellule).</li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                     <li><strong>Conversion de Couleur (`toHexColor`):</strong> Fonction utilitaire interne pour convertir différentes notations de couleur CSS (nom, rgb, etc.) en leur équivalent hexadécimal majuscule (`#RRGGBB`). Utilise une astuce DOM pour obtenir la couleur calculée.</li>
                    <li><strong>Gestion des Sauvegardes (`cell:saved`, `row:saved`):</strong> Met à jour `data-initial-value` avec la valeur hexadécimale actuelle (`data-value`) pour que la ligne ne soit plus considérée comme modifiée après une sauvegarde.</li>
                    <li><strong>Nouvelles Lignes (`row:added`):</strong> Appelle `setupColorCells` pour initialiser correctement les cellules couleur de la nouvelle ligne.</li>
                </ul>
            </section>

            <section id="plugin-color-events">
                <h2>Événements</h2>
                <ul>
                    <li><strong>Écoutés :</strong>
                        <ul>
                            <li><code>cell:saved</code> : Pour mettre à jour `data-initial-value` après sauvegarde.</li>
                            <li><code>row:saved</code> : Pour mettre à jour `data-initial-value` des cellules couleur de la ligne.</li>
                            <li><code>row:added</code> : Pour initialiser les nouvelles lignes.</li>
                        </ul>
                    </li>
                    <li><strong>Déclenchés :</strong>
                        <ul>
                            <li><code>cell:change</code> : Après qu'un utilisateur a sélectionné une nouvelle couleur. Contient `{ detail: { cellId, columnId, rowId, oldValue, newValue, cell } }` où les valeurs sont en hexadécimal.</li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section id="plugin-color-example">
                <h2>Exemple Complet</h2>
                <p>Cet exemple montre une table où l'on peut choisir la couleur d'un produit.</p>
                <div class="warning-block">
                    <strong>Rappel :</strong> Cet exemple suppose que la bibliothèque `ColorFlow` est correctement chargée sur la page.
                </div>

                <strong>HTML (`index.html`):</strong>
                <pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Exemple Color Plugin&lt;/title&gt;
    <link rel="stylesheet" href="../src/tableFlow.css"> <link rel="stylesheet" href="documentation.css"> <style>
        tr.modified td { background-color: #fffbeb; }
        /* Styles par défaut du plugin Color */
        .tf-color-wrapper{display:flex;align-items:center;justify-content:flex-start;gap:5px;padding:0}
        .tf-color-wrapper .color-preview{width:20px;height:20px;border:1px solid #e5e7eb;border-radius:4px;cursor:pointer}
        .tf-color-wrapper .color-input{width:80px;text-align:center;border:1px solid #e5e7eb;border-radius:4px;padding:3px 5px;font-size:inherit}
    </style>
    &lt;!-- Inclure ColorFlow ici --&gt;
    &lt;!-- &lt;script src="path/to/colorFlow.js"&gt;&lt;/script&gt; --&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;TableFlow - Exemple Plugin Color&lt;/h1&gt;

    &lt;table id="productTable"&gt;
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th id="prodName"&gt;Produit&lt;/th&gt;
                &lt;th id="prodColor" th-color&gt;Couleur Choisie&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
            &lt;tr id="p1"&gt;
                &lt;td id="prodName_p1"&gt;Casquette&lt;/td&gt;
                &lt;td id="prodColor_p1" data-value="#008000"&gt;green&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr id="p2"&gt;
                &lt;td id="prodName_p2"&gt;Écharpe&lt;/td&gt;
                &lt;td id="prodColor_p2" data-value="#FFA500"&gt;Orange&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/tbody&gt;
    &lt;/table&gt;

    &lt;!-- Script d'initialisation --&gt;
    &lt;script type="module"&gt;
        import TableFlow from '../src/tableFlow.js'; // Ajustez

        // Simuler ColorFlow si non disponible pour l'exemple
        if (typeof ColorFlow === 'undefined') {
            window.ColorFlow = class {
                constructor(config) { console.log('Simulating ColorFlow init with config:', config); }
                setupInput(input) {
                    console.log('Simulating ColorFlow setupInput for:', input);
                    // Ajouter un faux preview pour le style
                    const preview = document.createElement('span');
                    preview.className = 'color-preview';
                    preview.style.backgroundColor = input.value;
                    preview.onclick = () => { // Simuler un changement de couleur au clic sur le preview
                        const randomColor = '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');
                        input.value = randomColor.toUpperCase();
                        input.dispatchEvent(new Event('change', { bubbles: true })); // Déclencher 'change'
                    };
                    input.parentNode.insertBefore(preview, input);

                    // Mettre à jour le preview si l'input change
                     input.addEventListener('change', () => {
                         if(input.previousElementSibling && input.previousElementSibling.classList.contains('color-preview')) {
                            input.previousElementSibling.style.backgroundColor = input.value;
                         }
                     });
                }
            }
            console.warn("ColorFlow n'est pas chargé. Utilisation d'une simulation basique.");
        }


        const productTable = new TableFlow({
            tableId: 'productTable',
            pluginsPath: '../plugins', // Ajustez
            debug: true,
            plugins: {
                names: ['Color'], // Activer le plugin
                color: {
                    // Utiliser les options par défaut
                }
            }
        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

                <strong>Fonctionnement de l'exemple :</strong>
                <ol>
                    <li>La table s'affiche. Dans la colonne "Couleur Choisie", chaque cellule contient un carré de couleur (l'aperçu) et un champ de texte avec le code hexadécimal (`#RRGGBB`).</li>
                    <li>Cliquer sur le carré de couleur ou sur le champ de texte devrait ouvrir le sélecteur de couleur (fourni par ColorFlow). Dans la simulation, cliquer sur le carré change la couleur aléatoirement.</li>
                    <li>Lorsque vous choisissez une nouvelle couleur via le picker (ou via la simulation), l'aperçu, le champ de texte et l'attribut `data-value` sont mis à jour avec le nouveau code hexadécimal.</li>
                    <li>Si la couleur choisie est différente de la couleur initiale, la ligne est marquée en jaune pâle (classe `modified`).</li>
                </ol>
            </section>

        </div>
    </div>
</body>
</html>